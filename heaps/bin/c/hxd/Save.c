// Generated by HLC 4.1.5 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <hxd/Save.h>
extern hxd__$Save g$_hxd_Save;
String String___add__(String,String);
String haxe_crypto_Sha1_encode(String);
extern hl_type t$_i32;
String String_substr(String,int,vdynamic*);
#include <hl/types/ArrayObj.h>
vdynamic* String_charCodeAt(String,int);
extern String s$Missing_CRC;
vdynamic* haxe_Exception_thrown(vdynamic*);
int String___compare(String,vdynamic*);
extern String s$Invalid_CRC;
vdynamic* haxe_Unserializer_run(String);
bool Reflect_isObject(vdynamic*);
hl__types__ArrayObj Reflect_fields(vdynamic*);
bool Reflect_hasField(vdynamic*,String);
vdynamic* Reflect_field(vdynamic*,String);
void Reflect_setField(vdynamic*,String,vdynamic*);
String haxe_Serializer_run(vdynamic*);
extern String s$01abfc7;
extern String s$save;
extern String s$_sav;
String sys_io_File_getContent(String);
void sys_io_File_saveContent(String,String);
extern hl_type t$String;
extern hl_type t$_dyn;

String hxd_Save_makeCRC(String r0) {
	String r1, r2, r3;
	hxd__$Save r4;
	vdynamic *r7;
	int r5, r6;
	r4 = (hxd__$Save)g$_hxd_Save;
	r3 = r4->SALT;
	r2 = String___add__(r0,r3);
	r2 = haxe_crypto_Sha1_encode(r2);
	r1 = String___add__(r0,r2);
	r1 = haxe_crypto_Sha1_encode(r1);
	if( r1 == NULL ) hl_null_access();
	r5 = 4;
	r6 = 32;
	r7 = hl_alloc_dynamic(&t$_i32);
	r7->v.i = r6;
	r1 = String_substr(r1,r5,r7);
	return r1;
}

vdynamic* hxd_Save_loadData(String r0,bool r1,vdynamic* r2) {
	String r6, r8;
	hl__types__ArrayObj r13;
	bool r4;
	vdynamic *r5, *r10, *r11, *r12, *r16;
	varray *r15;
	int r7, r9, r14;
	if( !r1 ) goto label$bc1b389_2_27;
	if( r0 == NULL ) hl_null_access();
	r7 = r0->length;
	r9 = 33;
	r7 = r7 - r9;
	r5 = String_charCodeAt(r0,r7);
	r7 = 35;
	r10 = hl_alloc_dynamic(&t$_i32);
	r10->v.i = r7;
	if( r5 == r10 || (r5 && r10 && (r5->v.i == r10->v.i)) ) goto label$bc1b389_2_12;
	r6 = (String)s$Missing_CRC;
	r11 = haxe_Exception_thrown(((vdynamic*)r6));
	hl_throw((vdynamic*)r11);
	label$bc1b389_2_12:
	r7 = r0->length;
	r9 = 32;
	r7 = r7 - r9;
	r5 = NULL;
	r6 = String_substr(r0,r7,r5);
	r7 = 0;
	r9 = -33;
	r5 = hl_alloc_dynamic(&t$_i32);
	r5->v.i = r9;
	r8 = String_substr(r0,r7,r5);
	r0 = r8;
	r8 = hxd_Save_makeCRC(r8);
	if( r8 == r6 || (r8 && r6 && String___compare(r8,(vdynamic*)r6) == 0) ) goto label$bc1b389_2_27;
	r8 = (String)s$Invalid_CRC;
	r11 = haxe_Exception_thrown(((vdynamic*)r8));
	hl_throw((vdynamic*)r11);
	label$bc1b389_2_27:
	r11 = haxe_Unserializer_run(r0);
	if( !r2 ) goto label$bc1b389_2_53;
	r4 = Reflect_isObject(r11);
	if( !r4 ) goto label$bc1b389_2_53;
	r4 = Reflect_isObject(r2);
	if( !r4 ) goto label$bc1b389_2_53;
	r7 = 0;
	r13 = Reflect_fields(r2);
	label$bc1b389_2_35:
	if( r13 == NULL ) hl_null_access();
	r14 = r13->length;
	if( r7 >= r14 ) goto label$bc1b389_2_53;
	r14 = r13->length;
	if( ((unsigned)r7) < ((unsigned)r14) ) goto label$bc1b389_2_43;
	r6 = NULL;
	goto label$bc1b389_2_46;
	label$bc1b389_2_43:
	r15 = r13->array;
	r12 = ((vdynamic**)(r15 + 1))[r7];
	r6 = (String)r12;
	label$bc1b389_2_46:
	++r7;
	r4 = Reflect_hasField(r11,r6);
	if( !r4 ) goto label$bc1b389_2_50;
	goto label$bc1b389_2_35;
	label$bc1b389_2_50:
	r16 = Reflect_field(r2,r6);
	Reflect_setField(r11,r6,r16);
	goto label$bc1b389_2_35;
	label$bc1b389_2_53:
	return r11;
}

vdynamic* hxd_Save_saveData(vdynamic* r0,bool r1) {
	String r2, r3, r4;
	r2 = haxe_Serializer_run(r0);
	if( !r1 ) goto label$bc1b389_3_7;
	r4 = (String)s$01abfc7;
	r3 = String___add__(r2,r4);
	r4 = hxd_Save_makeCRC(r2);
	r3 = String___add__(r3,r4);
	return ((vdynamic*)r3);
	label$bc1b389_3_7:
	return ((vdynamic*)r2);
}

vdynamic* hxd_Save_load(vdynamic* r0,String r1,bool* r2) {
	String r3;
	hxd__$Save r7;
	bool r4;
	vclosure *r6;
	vdynamic *r5, *r8;
	hl_trap_ctx trap$0;
	if( r1 ) goto label$bc1b389_4_3;
	r3 = (String)s$save;
	r1 = r3;
	label$bc1b389_4_3:
	if( r2 ) goto label$bc1b389_4_6;
	r4 = false;
	goto label$bc1b389_4_7;
	label$bc1b389_4_6:
	r4 = *r2;
	label$bc1b389_4_7:
	hl_trap(trap$0,r5,label$bc1b389_4_16);
	r7 = (hxd__$Save)g$_hxd_Save;
	r6 = r7->readSaveData;
	if( r6 == NULL ) hl_null_access();
	r3 = r6->hasValue ? ((String (*)(vdynamic*,String))r6->fun)((vdynamic*)r6->value,r1) : ((String (*)(String))r6->fun)(r1);
	r5 = hxd_Save_loadData(r3,r4,r0);
	hl_endtrap(trap$0);
	return r5;
	hl_endtrap(trap$0);
	label$bc1b389_4_16:
	r8 = NULL;
	return r0;
}

String hxd_Save_readSaveData(String r0) {
	String r1, r2;
	r2 = (String)s$_sav;
	r1 = String___add__(r0,r2);
	r1 = sys_io_File_getContent(r1);
	return r1;
}

void hxd_Save_writeSaveData(String r0,String r1) {
	String r3, r4;
	r4 = (String)s$_sav;
	r3 = String___add__(r0,r4);
	sys_io_File_saveContent(r3,r1);
	return;
}

bool hxd_Save_save(vdynamic* r0,String r1,bool* r2) {
	String r3, r8;
	hxd__$Save r10;
	bool r4, r6;
	vclosure *r9, *r12;
	vdynamic *r5, *r11;
	hl_trap_ctx trap$0;
	if( r1 ) goto label$bc1b389_7_3;
	r3 = (String)s$save;
	r1 = r3;
	label$bc1b389_7_3:
	if( r2 ) goto label$bc1b389_7_6;
	r4 = false;
	goto label$bc1b389_7_7;
	label$bc1b389_7_6:
	r4 = *r2;
	label$bc1b389_7_7:
	r5 = hxd_Save_saveData(r0,r4);
	r3 = (String)hl_dyn_castp(&r5,&t$_dyn,&t$String);
	hl_trap(trap$0,r5,label$bc1b389_7_20);
	r10 = (hxd__$Save)g$_hxd_Save;
	r9 = r10->readSaveData;
	if( r9 == NULL ) hl_null_access();
	r8 = r9->hasValue ? ((String (*)(vdynamic*,String))r9->fun)((vdynamic*)r9->value,r1) : ((String (*)(String))r9->fun)(r1);
	if( r8 != r3 && (!r8 || !r3 || String___compare(r8,(vdynamic*)r3) != 0) ) goto label$bc1b389_7_18;
	r6 = false;
	hl_endtrap(trap$0);
	return r6;
	label$bc1b389_7_18:
	hl_endtrap(trap$0);
	goto label$bc1b389_7_21;
	label$bc1b389_7_20:
	r11 = NULL;
	label$bc1b389_7_21:
	r10 = (hxd__$Save)g$_hxd_Save;
	r12 = r10->writeSaveData;
	if( r12 == NULL ) hl_null_access();
	r12->hasValue ? ((void (*)(vdynamic*,String,String))r12->fun)((vdynamic*)r12->value,r1,r3) : ((void (*)(String,String))r12->fun)(r1,r3);
	r6 = true;
	return r6;
}

