// Generated by HLC 4.1.5 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <hxlr/engine/Grid.h>
#include <hxlr/lines/LineBase.h>
#include <h2d/col/Point.h>
void hxlr_engine_Grid_addLine(hxlr__engine__Grid,hxlr__lines__LineBase);
vvirtual* hxlr_engine_Cell_getInfo(double,double);
extern hl_type t$_i32;
void hxlr_engine_Grid_storeLine(hxlr__engine__Grid,hxlr__lines__LineBase,vvirtual*);
#include <hl/natives.h>
#include <components/managers/Simulation.h>
#include <_std/Main.h>
void hl_types_ArrayObj___expand(hl__types__ArrayObj,int);
void hl_types_ArrayBytes_Int___expand(hl__types__ArrayBytes_Int,int);
extern $Main g$_Main;
void components_managers_Simulation_updateSim(components__managers__Simulation);
#include <hxlr/engine/Cell.h>
extern hl_type t$String;
vdynamic* haxe_ds_StringMap_get(haxe__ds__StringMap,String);
extern hl_type t$vrt_e4dd42c;
extern hl_type t$hxlr_engine_Cell;
void hxlr_engine_Cell_new(hxlr__engine__Cell,vvirtual*);
extern hl_type t$haxe_ds_StringMap;
void haxe_ds_StringMap_set(haxe__ds__StringMap,String,vdynamic*);
void hxlr_engine_Cell_addLine(hxlr__engine__Cell,hxlr__lines__LineBase);
int hl_types_ArrayObj_push(hl__types__ArrayObj,vdynamic*);
void hxlr_engine_Grid_unregister(hxlr__engine__Grid,hxlr__lines__LineBase);
void hxlr_engine_Cell_removeLine(hxlr__engine__Cell,hxlr__lines__LineBase);
extern hl_type t$hl_types_ArrayBytes_Int;
void hl_types_ArrayBytes_Int_new(hl__types__ArrayBytes_Int);
void haxe_ds_StringMap_new(haxe__ds__StringMap);
extern hl_type t$hl_types_ArrayObj;
void hl_types_ArrayObj_new(hl__types__ArrayObj);

void hxlr_engine_Grid_register(hxlr__engine__Grid r0,hxlr__lines__LineBase r1) {
	vvirtual *r3, *r7, *r9;
	bool r18;
	h2d__col__Point r5;
	double r4, r6, r15, r16, r17, r19, r20, r21, r22;
	int r8, r10, r11, r12, r13, r14;
	hxlr_engine_Grid_addLine(r0,r1);
	if( r1 == NULL ) hl_null_access();
	r5 = r1->start;
	if( r5 == NULL ) hl_null_access();
	r4 = r5->x;
	r5 = r1->start;
	if( r5 == NULL ) hl_null_access();
	r6 = r5->y;
	r3 = hxlr_engine_Cell_getInfo(r4,r6);
	r5 = r1->end;
	if( r5 == NULL ) hl_null_access();
	r4 = r5->x;
	r5 = r1->end;
	if( r5 == NULL ) hl_null_access();
	r6 = r5->y;
	r7 = hxlr_engine_Cell_getInfo(r4,r6);
	r4 = r1->dx;
	r6 = 0.;
	if( !(r6 < r4) ) goto label$f3e15a3_1_22;
	if( r7 == NULL ) hl_null_access();
	r8 = hl_vfields(r7)[3] ? (*(int*)(hl_vfields(r7)[3])) : (int)hl_dyn_geti(r7->value,120/*x*/,&t$_i32);
	goto label$f3e15a3_1_24;
	label$f3e15a3_1_22:
	if( r3 == NULL ) hl_null_access();
	r8 = hl_vfields(r3)[3] ? (*(int*)(hl_vfields(r3)[3])) : (int)hl_dyn_geti(r3->value,120/*x*/,&t$_i32);
	label$f3e15a3_1_24:
	r4 = r1->dx;
	r6 = 0.;
	if( !(r6 < r4) ) goto label$f3e15a3_1_30;
	if( r3 == NULL ) hl_null_access();
	r10 = hl_vfields(r3)[3] ? (*(int*)(hl_vfields(r3)[3])) : (int)hl_dyn_geti(r3->value,120/*x*/,&t$_i32);
	goto label$f3e15a3_1_32;
	label$f3e15a3_1_30:
	if( r7 == NULL ) hl_null_access();
	r10 = hl_vfields(r7)[3] ? (*(int*)(hl_vfields(r7)[3])) : (int)hl_dyn_geti(r7->value,120/*x*/,&t$_i32);
	label$f3e15a3_1_32:
	r4 = r1->dy;
	r6 = 0.;
	if( !(r6 < r4) ) goto label$f3e15a3_1_38;
	if( r7 == NULL ) hl_null_access();
	r11 = hl_vfields(r7)[4] ? (*(int*)(hl_vfields(r7)[4])) : (int)hl_dyn_geti(r7->value,121/*y*/,&t$_i32);
	goto label$f3e15a3_1_40;
	label$f3e15a3_1_38:
	if( r3 == NULL ) hl_null_access();
	r11 = hl_vfields(r3)[4] ? (*(int*)(hl_vfields(r3)[4])) : (int)hl_dyn_geti(r3->value,121/*y*/,&t$_i32);
	label$f3e15a3_1_40:
	r4 = r1->dy;
	r6 = 0.;
	if( !(r6 < r4) ) goto label$f3e15a3_1_46;
	if( r3 == NULL ) hl_null_access();
	r12 = hl_vfields(r3)[4] ? (*(int*)(hl_vfields(r3)[4])) : (int)hl_dyn_geti(r3->value,121/*y*/,&t$_i32);
	goto label$f3e15a3_1_48;
	label$f3e15a3_1_46:
	if( r7 == NULL ) hl_null_access();
	r12 = hl_vfields(r7)[4] ? (*(int*)(hl_vfields(r7)[4])) : (int)hl_dyn_geti(r7->value,121/*y*/,&t$_i32);
	label$f3e15a3_1_48:
	hxlr_engine_Grid_storeLine(r0,r1,r3);
	r4 = r1->dx;
	r6 = 0.;
	if( r4 != r6 ) goto label$f3e15a3_1_55;
	r4 = r1->dy;
	r6 = 0.;
	if( r4 == r6 ) goto label$f3e15a3_1_57;
	label$f3e15a3_1_55:
	if( r10 != r8 ) goto label$f3e15a3_1_58;
	if( r12 != r11 ) goto label$f3e15a3_1_58;
	label$f3e15a3_1_57:
	return;
	label$f3e15a3_1_58:
	r5 = r1->start;
	if( r5 == NULL ) hl_null_access();
	r4 = r5->x;
	r5 = r1->start;
	if( r5 == NULL ) hl_null_access();
	r6 = r5->y;
	r15 = 1.;
	r16 = r1->dx;
	r15 = r15 / r16;
	r16 = 1.;
	r17 = r1->dy;
	r16 = r16 / r17;
	label$f3e15a3_1_70:
	r18 = true;
	if( !r18 ) goto label$f3e15a3_1_184;
	if( r3 == NULL ) hl_null_access();
	r13 = hl_vfields(r3)[3] ? (*(int*)(hl_vfields(r3)[3])) : (int)hl_dyn_geti(r3->value,120/*x*/,&t$_i32);
	r14 = 0;
	if( r13 >= r14 ) goto label$f3e15a3_1_90;
	if( r1 == NULL ) hl_null_access();
	r19 = r1->dx;
	r20 = 0.;
	if( !(r20 < r19) ) goto label$f3e15a3_1_85;
	r19 = 14.;
	r20 = hl_vfields(r3)[0] ? (*(double*)(hl_vfields(r3)[0])) : (double)hl_dyn_getd(r3->value,23089/*gx*/);
	r19 = r19 + r20;
	goto label$f3e15a3_1_88;
	label$f3e15a3_1_85:
	r19 = -14.;
	r20 = hl_vfields(r3)[0] ? (*(double*)(hl_vfields(r3)[0])) : (double)hl_dyn_getd(r3->value,23089/*gx*/);
	r19 = r19 - r20;
	label$f3e15a3_1_88:
	r17 = r19;
	goto label$f3e15a3_1_103;
	label$f3e15a3_1_90:
	if( r1 == NULL ) hl_null_access();
	r19 = r1->dx;
	r20 = 0.;
	if( !(r20 < r19) ) goto label$f3e15a3_1_98;
	r19 = 14.;
	r20 = hl_vfields(r3)[0] ? (*(double*)(hl_vfields(r3)[0])) : (double)hl_dyn_getd(r3->value,23089/*gx*/);
	r19 = r19 - r20;
	goto label$f3e15a3_1_102;
	label$f3e15a3_1_98:
	r19 = hl_vfields(r3)[0] ? (*(double*)(hl_vfields(r3)[0])) : (double)hl_dyn_getd(r3->value,23089/*gx*/);
	r20 = 1.;
	r19 = r19 + r20;
	r19 = -r19;
	label$f3e15a3_1_102:
	r17 = r19;
	label$f3e15a3_1_103:
	r13 = hl_vfields(r3)[4] ? (*(int*)(hl_vfields(r3)[4])) : (int)hl_dyn_geti(r3->value,121/*y*/,&t$_i32);
	r14 = 0;
	if( r13 >= r14 ) goto label$f3e15a3_1_118;
	r20 = r1->dy;
	r21 = 0.;
	if( !(r21 < r20) ) goto label$f3e15a3_1_113;
	r20 = 14.;
	r21 = hl_vfields(r3)[1] ? (*(double*)(hl_vfields(r3)[1])) : (double)hl_dyn_getd(r3->value,23090/*gy*/);
	r20 = r20 + r21;
	goto label$f3e15a3_1_116;
	label$f3e15a3_1_113:
	r20 = -14.;
	r21 = hl_vfields(r3)[1] ? (*(double*)(hl_vfields(r3)[1])) : (double)hl_dyn_getd(r3->value,23090/*gy*/);
	r20 = r20 - r21;
	label$f3e15a3_1_116:
	r19 = r20;
	goto label$f3e15a3_1_130;
	label$f3e15a3_1_118:
	r20 = r1->dy;
	r21 = 0.;
	if( !(r21 < r20) ) goto label$f3e15a3_1_125;
	r20 = 14.;
	r21 = hl_vfields(r3)[1] ? (*(double*)(hl_vfields(r3)[1])) : (double)hl_dyn_getd(r3->value,23090/*gy*/);
	r20 = r20 - r21;
	goto label$f3e15a3_1_129;
	label$f3e15a3_1_125:
	r20 = hl_vfields(r3)[1] ? (*(double*)(hl_vfields(r3)[1])) : (double)hl_dyn_getd(r3->value,23090/*gy*/);
	r21 = 1.;
	r20 = r20 + r21;
	r20 = -r20;
	label$f3e15a3_1_129:
	r19 = r20;
	label$f3e15a3_1_130:
	r20 = r1->dx;
	r21 = 0.;
	if( r20 != r21 ) goto label$f3e15a3_1_136;
	r20 = r6 + r19;
	r6 = r20;
	goto label$f3e15a3_1_170;
	label$f3e15a3_1_136:
	r20 = r1->dy;
	r21 = 0.;
	if( r20 != r21 ) goto label$f3e15a3_1_142;
	r20 = r4 + r17;
	r4 = r20;
	goto label$f3e15a3_1_170;
	label$f3e15a3_1_142:
	r21 = r1->dy;
	r21 = r21 * r17;
	r21 = r21 * r15;
	r20 = r6 + r21;
	r21 = r20 - r6;
	r21 = hl_math_abs(r21);
	r22 = hl_math_abs(r19);
	if( !(r21 < r22) ) goto label$f3e15a3_1_154;
	r21 = r4 + r17;
	r4 = r21;
	r6 = r20;
	goto label$f3e15a3_1_170;
	label$f3e15a3_1_154:
	r21 = r20 - r6;
	r21 = hl_math_abs(r21);
	r22 = hl_math_abs(r19);
	if( r21 != r22 ) goto label$f3e15a3_1_163;
	r21 = r4 + r17;
	r4 = r21;
	r21 = r6 + r19;
	r6 = r21;
	goto label$f3e15a3_1_170;
	label$f3e15a3_1_163:
	r22 = r1->dx;
	r22 = r22 * r19;
	r22 = r22 * r16;
	r21 = r4 + r22;
	r4 = r21;
	r21 = r6 + r19;
	r6 = r21;
	label$f3e15a3_1_170:
	r9 = hxlr_engine_Cell_getInfo(r4,r6);
	r3 = r9;
	if( r9 == NULL ) hl_null_access();
	r13 = hl_vfields(r9)[3] ? (*(int*)(hl_vfields(r9)[3])) : (int)hl_dyn_geti(r9->value,120/*x*/,&t$_i32);
	if( r13 < r10 ) goto label$f3e15a3_1_183;
	r13 = hl_vfields(r9)[3] ? (*(int*)(hl_vfields(r9)[3])) : (int)hl_dyn_geti(r9->value,120/*x*/,&t$_i32);
	if( r8 < r13 ) goto label$f3e15a3_1_183;
	r13 = hl_vfields(r9)[4] ? (*(int*)(hl_vfields(r9)[4])) : (int)hl_dyn_geti(r9->value,121/*y*/,&t$_i32);
	if( r13 < r12 ) goto label$f3e15a3_1_183;
	r13 = hl_vfields(r9)[4] ? (*(int*)(hl_vfields(r9)[4])) : (int)hl_dyn_geti(r9->value,121/*y*/,&t$_i32);
	if( r11 < r13 ) goto label$f3e15a3_1_183;
	hxlr_engine_Grid_storeLine(r0,r1,r9);
	goto label$f3e15a3_1_70;
	label$f3e15a3_1_183:
	return;
	label$f3e15a3_1_184:
	return;
}

void hxlr_engine_Grid_addLine(hxlr__engine__Grid r0,hxlr__lines__LineBase r1) {
	hl__types__ArrayObj r5;
	hl__types__ArrayBytes_Int r8;
	$Main r12;
	components__managers__Simulation r11;
	vdynamic *r3;
	vbyte *r9;
	varray *r7;
	int r4, r6, r10;
	if( r1 == NULL ) hl_null_access();
	r3 = r1->id;
	if( r3 ) goto label$f3e15a3_2_6;
	r4 = r0->lineIDCount;
	r3 = hl_alloc_dynamic(&t$_i32);
	r3->v.i = r4;
	r1->id = r3;
	label$f3e15a3_2_6:
	r5 = r0->lines;
	if( r5 == NULL ) hl_null_access();
	r3 = r1->id;
	r4 = r3 ? r3->v.i : 0;
	r6 = r5->length;
	if( ((unsigned)r4) < ((unsigned)r6) ) goto label$f3e15a3_2_13;
	hl_types_ArrayObj___expand(r5,r4);
	label$f3e15a3_2_13:
	r7 = r5->array;
	((hxlr__lines__LineBase*)(r7 + 1))[r4] = r1;
	r4 = r0->lineCount;
	++r4;
	r0->lineCount = r4;
	r4 = r0->lineIDCount;
	++r4;
	r0->lineIDCount = r4;
	r8 = r0->subTypeCount;
	if( r8 == NULL ) hl_null_access();
	r4 = r1->type;
	r6 = r8->length;
	if( ((unsigned)r4) < ((unsigned)r6) ) goto label$f3e15a3_2_27;
	hl_types_ArrayBytes_Int___expand(r8,r4);
	label$f3e15a3_2_27:
	r9 = r8->bytes;
	r6 = 2;
	r6 = r4 << r6;
	r10 = *(int*)(r9 + r6);
	++r10;
	*(int*)(r9 + r6) = r10;
	r12 = ($Main)g$_Main;
	r11 = r12->simulation;
	if( r11 == NULL ) hl_null_access();
	components_managers_Simulation_updateSim(r11);
	return;
}

void hxlr_engine_Grid_storeLine(hxlr__engine__Grid r0,hxlr__lines__LineBase r1,vvirtual* r2) {
	String r6;
	hl__types__ArrayObj r10;
	vvirtual *r8;
	haxe__ds__StringMap r5;
	hxlr__engine__Cell r7;
	vdynamic *r4;
	int r9;
	r5 = r0->registry;
	if( r5 == NULL ) hl_null_access();
	if( r2 == NULL ) hl_null_access();
	r6 = hl_vfields(r2)[2] ? (*(String*)(hl_vfields(r2)[2])) : (String)hl_dyn_getp(r2->value,5343647/*key*/,&t$String);
	r4 = haxe_ds_StringMap_get(r5,r6);
	r7 = (hxlr__engine__Cell)r4;
	if( r7 ) goto label$f3e15a3_3_21;
	r5 = r0->registry;
	if( r5 ) goto label$f3e15a3_3_11;
	r8 = NULL;
	goto label$f3e15a3_3_15;
	label$f3e15a3_3_11:
	r8 = r5->f$1;
	if( r8 ) goto label$f3e15a3_3_15;
	r8 = hl_to_virtual(&t$vrt_e4dd42c,(vdynamic*)r5);
	r5->f$1 = r8;
	label$f3e15a3_3_15:
	r6 = hl_vfields(r2)[2] ? (*(String*)(hl_vfields(r2)[2])) : (String)hl_dyn_getp(r2->value,5343647/*key*/,&t$String);
	r7 = (hxlr__engine__Cell)hl_alloc_obj(&t$hxlr_engine_Cell);
	hxlr_engine_Cell_new(r7,r2);
	r5 = (haxe__ds__StringMap)hl_dyn_castp(&r8,&t$vrt_e4dd42c,&t$haxe_ds_StringMap);
	if( r5 == NULL ) hl_null_access();
	haxe_ds_StringMap_set(r5,r6,((vdynamic*)r7));
	label$f3e15a3_3_21:
	r5 = r0->registry;
	if( r5 == NULL ) hl_null_access();
	r6 = hl_vfields(r2)[2] ? (*(String*)(hl_vfields(r2)[2])) : (String)hl_dyn_getp(r2->value,5343647/*key*/,&t$String);
	r4 = haxe_ds_StringMap_get(r5,r6);
	r7 = (hxlr__engine__Cell)r4;
	if( r7 == NULL ) hl_null_access();
	hxlr_engine_Cell_addLine(r7,r1);
	if( r1 == NULL ) hl_null_access();
	r10 = r1->keyList;
	if( r10 == NULL ) hl_null_access();
	r6 = hl_vfields(r2)[2] ? (*(String*)(hl_vfields(r2)[2])) : (String)hl_dyn_getp(r2->value,5343647/*key*/,&t$String);
	r9 = hl_types_ArrayObj_push(r10,((vdynamic*)r6));
	return;
}

void hxlr_engine_Grid_deleteTrack(hxlr__engine__Grid r0) {
	hl__types__ArrayObj r3;
	hxlr__lines__LineBase r5;
	vdynamic *r6;
	varray *r7;
	int r1, r4;
	r1 = 0;
	r3 = r0->lines;
	label$f3e15a3_4_2:
	if( r3 == NULL ) hl_null_access();
	r4 = r3->length;
	if( r1 >= r4 ) goto label$f3e15a3_4_16;
	r4 = r3->length;
	if( ((unsigned)r1) < ((unsigned)r4) ) goto label$f3e15a3_4_10;
	r5 = NULL;
	goto label$f3e15a3_4_13;
	label$f3e15a3_4_10:
	r7 = r3->array;
	r6 = ((vdynamic**)(r7 + 1))[r1];
	r5 = (hxlr__lines__LineBase)r6;
	label$f3e15a3_4_13:
	++r1;
	hxlr_engine_Grid_unregister(r0,r5);
	goto label$f3e15a3_4_2;
	label$f3e15a3_4_16:
	return;
}

void hxlr_engine_Grid_unregister(hxlr__engine__Grid r0,hxlr__lines__LineBase r1) {
	String r9;
	haxe__ds__StringMap r11;
	hl__types__ArrayObj r6;
	hl__types__ArrayBytes_Int r13;
	hxlr__engine__Cell r12;
	hxlr__lines__LineBase r3;
	vdynamic *r4, *r15;
	vbyte *r14;
	varray *r10;
	int r5, r7, r8;
	if( r1 ) goto label$f3e15a3_5_2;
	return;
	label$f3e15a3_5_2:
	r5 = 0;
	if( r1 == NULL ) hl_null_access();
	r6 = r1->keyList;
	label$f3e15a3_5_5:
	if( r6 == NULL ) hl_null_access();
	r8 = r6->length;
	if( r5 >= r8 ) goto label$f3e15a3_5_24;
	r8 = r6->length;
	if( ((unsigned)r5) < ((unsigned)r8) ) goto label$f3e15a3_5_13;
	r9 = NULL;
	goto label$f3e15a3_5_16;
	label$f3e15a3_5_13:
	r10 = r6->array;
	r4 = ((vdynamic**)(r10 + 1))[r5];
	r9 = (String)r4;
	label$f3e15a3_5_16:
	++r5;
	r11 = r0->registry;
	if( r11 == NULL ) hl_null_access();
	r4 = haxe_ds_StringMap_get(r11,r9);
	r12 = (hxlr__engine__Cell)r4;
	if( r12 == NULL ) hl_null_access();
	hxlr_engine_Cell_removeLine(r12,r1);
	goto label$f3e15a3_5_5;
	label$f3e15a3_5_24:
	r5 = r0->lineCount;
	--r5;
	r0->lineCount = r5;
	r13 = r0->subTypeCount;
	if( r13 == NULL ) hl_null_access();
	if( r1 == NULL ) hl_null_access();
	r5 = r1->type;
	r7 = r13->length;
	if( ((unsigned)r5) < ((unsigned)r7) ) goto label$f3e15a3_5_34;
	hl_types_ArrayBytes_Int___expand(r13,r5);
	label$f3e15a3_5_34:
	r14 = r13->bytes;
	r7 = 2;
	r7 = r5 << r7;
	r8 = *(int*)(r14 + r7);
	--r8;
	*(int*)(r14 + r7) = r8;
	r6 = r0->lines;
	if( r6 == NULL ) hl_null_access();
	r15 = r1->id;
	r5 = r15 ? r15->v.i : 0;
	r3 = NULL;
	r7 = r6->length;
	if( ((unsigned)r5) < ((unsigned)r7) ) goto label$f3e15a3_5_48;
	hl_types_ArrayObj___expand(r6,r5);
	label$f3e15a3_5_48:
	r10 = r6->array;
	((hxlr__lines__LineBase*)(r10 + 1))[r5] = r3;
	return;
}

void hxlr_engine_Grid_new(hxlr__engine__Grid r0) {
	hl__types__ArrayObj r5;
	haxe__ds__StringMap r4;
	hl__types__ArrayBytes_Int r1;
	int r3;
	r1 = (hl__types__ArrayBytes_Int)hl_alloc_obj(&t$hl_types_ArrayBytes_Int);
	hl_types_ArrayBytes_Int_new(r1);
	r0->subTypeCount = r1;
	r3 = 0;
	r0->lineIDCount = r3;
	r3 = 0;
	r0->lineCount = r3;
	r4 = (haxe__ds__StringMap)hl_alloc_obj(&t$haxe_ds_StringMap);
	haxe_ds_StringMap_new(r4);
	r0->registry = r4;
	r5 = (hl__types__ArrayObj)hl_alloc_obj(&t$hl_types_ArrayObj);
	hl_types_ArrayObj_new(r5);
	r0->lines = r5;
	return;
}

