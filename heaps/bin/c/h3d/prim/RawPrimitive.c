// Generated by HLC 4.1.5 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <h3d/prim/RawPrimitive.h>
extern hl_type t$vrt_95f8d91;
#include <h3d/Engine.h>
void h3d_prim_Primitive_new(h3d__prim__Primitive);
extern hl_type t$fun_bdaaaea;
extern hl_type t$h3d_col_Bounds;
void h3d_prim_RawPrimitive_alloc(h3d__prim__RawPrimitive,h3d__Engine);
#include <hl/types/ArrayObj.h>
#include <h3d/BufferFlag.h>
extern String s$Cannot_realloc_;
String Std_string(vdynamic*);
String String___add__(String,String);
vdynamic* haxe_Exception_thrown(vdynamic*);
extern hl_type t$h3d_BufferFlag;
#include <hl/natives.h>
hl__types__ArrayObj hl_types_ArrayObj_alloc(varray*);
extern hl_type t$hl_types_ArrayBytes_hl_UI16;
extern hl_type t$nul_bool;
extern venum* g$h3d_BufferFlag_Quads;
extern venum* g$h3d_BufferFlag_Triangles;
int hl_types_ArrayObj_push(hl__types__ArrayObj,vdynamic*);
extern hl_type t$_i32;
extern venum* g$h3d_BufferFlag_RawFormat;
extern hl_type t$hl_types_ArrayBytes_hl_F32;
h3d__Buffer h3d_Buffer_ofFloats(hl__types__ArrayBytes_hl_F32,int,hl__types__ArrayObj);
h3d__Indexes h3d_Indexes_alloc(hl__types__ArrayBytes_hl_UI16,int*,int*);
void h3d_Indexes_dispose(h3d__Indexes);
extern String s$Bounds_not_defined_for_;

vvirtual* h3d_prim_RawPrimitive_new__$1(vvirtual* r0) {
	vvirtual *r1;
	r1 = hl_to_virtual(&t$vrt_95f8d91,(vdynamic*)r0);
	return r1;
}

void h3d_prim_RawPrimitive_new(h3d__prim__RawPrimitive r0,vvirtual* r1,bool* r2) {
	bool r3;
	h3d__col__Bounds r6;
	h3d__Engine r7;
	vclosure *r5;
	if( r2 ) goto label$988e981_2_3;
	r3 = false;
	goto label$988e981_2_4;
	label$988e981_2_3:
	r3 = *r2;
	label$988e981_2_4:
	h3d_prim_Primitive_new(((h3d__prim__Primitive)r0));
	r5 = hl_alloc_closure_ptr(&t$fun_bdaaaea,h3d_prim_RawPrimitive_new__$1,r1);
	r0->onContextLost = r5;
	if( r1 == NULL ) hl_null_access();
	r6 = hl_vfields(r1)[0] ? (*(h3d__col__Bounds*)(hl_vfields(r1)[0])) : (h3d__col__Bounds)hl_dyn_getp(r1->value,102598660/*bounds*/,&t$h3d_col_Bounds);
	r0->bounds = r6;
	r7 = NULL;
	h3d_prim_RawPrimitive_alloc(r0,r7);
	if( r3 ) goto label$988e981_2_15;
	r5 = NULL;
	r0->onContextLost = r5;
	label$988e981_2_15:
	return;
}

void h3d_prim_RawPrimitive_alloc(h3d__prim__RawPrimitive r0,h3d__Engine r1) {
	String r5, r6;
	hl__types__ArrayObj r8;
	vvirtual *r7;
	venum *r13;
	hl_type *r10;
	hl__types__ArrayBytes_hl_F32 r18;
	bool r15;
	hl__types__ArrayBytes_hl_UI16 r12;
	double r19, r20;
	h3d__Buffer r17;
	vclosure *r3;
	int *r23, *r24;
	vdynamic *r4, *r14;
	h3d__Indexes r22;
	int r11, r16, r21;
	varray *r9;
	r3 = r0->onContextLost;
	if( r3 ) goto label$988e981_3_7;
	r5 = (String)s$Cannot_realloc_;
	r6 = Std_string(((vdynamic*)r0));
	r5 = String___add__(r5,r6);
	r4 = haxe_Exception_thrown(((vdynamic*)r5));
	hl_throw((vdynamic*)r4);
	label$988e981_3_7:
	r3 = r0->onContextLost;
	if( r3 == NULL ) hl_null_access();
	r7 = r3->hasValue ? ((vvirtual* (*)(vdynamic*))r3->fun)((vdynamic*)r3->value) : ((vvirtual* (*)(void))r3->fun)();
	r10 = &t$h3d_BufferFlag;
	r11 = 0;
	r9 = hl_alloc_array(r10,r11);
	r8 = hl_types_ArrayObj_alloc(r9);
	if( r7 == NULL ) hl_null_access();
	r12 = hl_vfields(r7)[0] ? (*(hl__types__ArrayBytes_hl_UI16*)(hl_vfields(r7)[0])) : (hl__types__ArrayBytes_hl_UI16)hl_dyn_getp(r7->value,95562612/*ibuf*/,&t$hl_types_ArrayBytes_hl_UI16);
	if( r12 ) goto label$988e981_3_25;
	if( r8 == NULL ) hl_null_access();
	r14 = hl_vfields(r7)[1] ? (*(vdynamic**)(hl_vfields(r7)[1])) : (vdynamic*)hl_dyn_getp(r7->value,501708502/*quads*/,&t$nul_bool);
	r15 = r14 ? r14->v.b : 0;
	if( !r15 ) goto label$988e981_3_23;
	r13 = (venum*)g$h3d_BufferFlag_Quads;
	goto label$988e981_3_24;
	label$988e981_3_23:
	r13 = (venum*)g$h3d_BufferFlag_Triangles;
	label$988e981_3_24:
	r11 = hl_types_ArrayObj_push(r8,((vdynamic*)r13));
	label$988e981_3_25:
	r11 = hl_vfields(r7)[2] ? (*(int*)(hl_vfields(r7)[2])) : (int)hl_dyn_geti(r7->value,288366617/*stride*/,&t$_i32);
	r16 = 8;
	if( r11 >= r16 ) goto label$988e981_3_31;
	if( r8 == NULL ) hl_null_access();
	r13 = (venum*)g$h3d_BufferFlag_RawFormat;
	r11 = hl_types_ArrayObj_push(r8,((vdynamic*)r13));
	label$988e981_3_31:
	r18 = hl_vfields(r7)[3] ? (*(hl__types__ArrayBytes_hl_F32*)(hl_vfields(r7)[3])) : (hl__types__ArrayBytes_hl_F32)hl_dyn_getp(r7->value,239726983/*vbuf*/,&t$hl_types_ArrayBytes_hl_F32);
	r11 = hl_vfields(r7)[2] ? (*(int*)(hl_vfields(r7)[2])) : (int)hl_dyn_geti(r7->value,288366617/*stride*/,&t$_i32);
	r17 = h3d_Buffer_ofFloats(r18,r11,r8);
	r0->buffer = r17;
	r17 = r0->buffer;
	if( r17 == NULL ) hl_null_access();
	r11 = r17->vertices;
	r0->vcount = r11;
	r12 = hl_vfields(r7)[0] ? (*(hl__types__ArrayBytes_hl_UI16*)(hl_vfields(r7)[0])) : (hl__types__ArrayBytes_hl_UI16)hl_dyn_getp(r7->value,95562612/*ibuf*/,&t$hl_types_ArrayBytes_hl_UI16);
	if( !r12 ) goto label$988e981_3_49;
	r12 = hl_vfields(r7)[0] ? (*(hl__types__ArrayBytes_hl_UI16*)(hl_vfields(r7)[0])) : (hl__types__ArrayBytes_hl_UI16)hl_dyn_getp(r7->value,95562612/*ibuf*/,&t$hl_types_ArrayBytes_hl_UI16);
	if( r12 == NULL ) hl_null_access();
	r11 = r12->length;
	r19 = (double)r11;
	r20 = 3.;
	r19 = r19 / r20;
	r16 = (int)r19;
	goto label$988e981_3_61;
	label$988e981_3_49:
	r14 = hl_vfields(r7)[1] ? (*(vdynamic**)(hl_vfields(r7)[1])) : (vdynamic*)hl_dyn_getp(r7->value,501708502/*quads*/,&t$nul_bool);
	r15 = r14 ? r14->v.b : 0;
	if( !r15 ) goto label$988e981_3_56;
	r16 = r0->vcount;
	r21 = 1;
	r16 = r16 >> r21;
	goto label$988e981_3_61;
	label$988e981_3_56:
	r16 = r0->vcount;
	r19 = (double)r16;
	r20 = 3.;
	r19 = r19 / r20;
	r16 = (int)r19;
	label$988e981_3_61:
	r0->tcount = r16;
	r12 = hl_vfields(r7)[0] ? (*(hl__types__ArrayBytes_hl_UI16*)(hl_vfields(r7)[0])) : (hl__types__ArrayBytes_hl_UI16)hl_dyn_getp(r7->value,95562612/*ibuf*/,&t$hl_types_ArrayBytes_hl_UI16);
	if( !r12 ) goto label$988e981_3_70;
	r12 = hl_vfields(r7)[0] ? (*(hl__types__ArrayBytes_hl_UI16*)(hl_vfields(r7)[0])) : (hl__types__ArrayBytes_hl_UI16)hl_dyn_getp(r7->value,95562612/*ibuf*/,&t$hl_types_ArrayBytes_hl_UI16);
	r23 = NULL;
	r24 = NULL;
	r22 = h3d_Indexes_alloc(r12,r23,r24);
	r0->indexes = r22;
	goto label$988e981_3_77;
	label$988e981_3_70:
	r22 = r0->indexes;
	if( !r22 ) goto label$988e981_3_77;
	r22 = r0->indexes;
	if( r22 == NULL ) hl_null_access();
	h3d_Indexes_dispose(r22);
	r22 = NULL;
	r0->indexes = r22;
	label$988e981_3_77:
	return;
}

h3d__col__Bounds h3d_prim_RawPrimitive_getBounds(h3d__prim__RawPrimitive r0) {
	String r3, r4;
	h3d__col__Bounds r1;
	vdynamic *r2;
	r1 = r0->bounds;
	if( r1 ) goto label$988e981_4_7;
	r3 = (String)s$Bounds_not_defined_for_;
	r4 = Std_string(((vdynamic*)r0));
	r3 = String___add__(r3,r4);
	r2 = haxe_Exception_thrown(((vdynamic*)r3));
	hl_throw((vdynamic*)r2);
	label$988e981_4_7:
	r1 = r0->bounds;
	return r1;
}

