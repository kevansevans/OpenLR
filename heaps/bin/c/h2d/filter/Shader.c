// Generated by HLC 4.1.4 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <h2d/filter/Shader.h>
#include <h3d/shader/ScreenShader.h>
#include <hl/types/ArrayObj.h>
#include <hxsl/SharedShader.h>
#include <hxsl/VarKind.h>
#include <hxsl/Type.h>
extern String s$texture;
void h2d_filter_Filter_new(h2d__filter__Filter);
extern hl_type t$hl_types_ArrayObj;
extern hl_type t$vrt_09f4a29;
extern hl_type t$String;
int String___compare(String,vdynamic*);
extern String s$Shader_does_not_have_;
String String___add__(String,String);
extern String s$_variable;
vdynamic* haxe_Exception_thrown(vdynamic*);
extern hl_type t$h3d_pass_ScreenFx;
void h3d_pass_ScreenFx_new(h3d__pass__ScreenFx,h3d__shader__ScreenShader,hl__types__ArrayObj);
#include <h2d/RenderContext.h>
#include <h2d/Tile.h>
#include <h3d/mat/Texture.h>
#include <h3d/impl/TextureCache.h>
#include <hxd/PixelFormat.h>
#include <h3d/Engine.h>
#include <h3d/mat/Filter.h>
extern String s$shaderTmp;
h3d__mat__Texture h3d_impl_TextureCache_allocTileTarget(h3d__impl__TextureCache,String,h2d__Tile,bool*,venum*);
void h3d_Engine_pushTarget(h3d__Engine,h3d__mat__Texture,int*,int*);
extern String s$__;
void Reflect_setField(vdynamic*,String,vdynamic*);
extern venum* g$h3d_mat_Filter_Nearest;
venum* h3d_mat_Texture_set_filter(h3d__mat__Texture,venum*);
void h3d_pass_ScreenFx_render(h3d__pass__ScreenFx);
void h3d_Engine_popTarget(h3d__Engine);
h2d__Tile h2d_Tile_fromTexture(h3d__mat__Texture);

void h2d_filter_Shader_new(h2d__filter__Shader r0,h3d__shader__ScreenShader r1,String r2) {
	String r3, r14;
	vvirtual *r8, *r11;
	hl__types__ArrayObj r7;
	bool r5, r15;
	hxsl__SharedShader r9;
	h3d__pass__ScreenFx r16;
	vdynamic *r12;
	varray *r13;
	int r6, r10;
	if( r2 ) goto label$de0a185_1_3;
	r3 = (String)s$texture;
	r2 = r3;
	label$de0a185_1_3:
	h2d_filter_Filter_new(((h2d__filter__Filter)r0));
	r5 = false;
	r6 = 0;
	if( r1 == NULL ) hl_null_access();
	r9 = r1->shader;
	if( r9 == NULL ) hl_null_access();
	r8 = r9->data;
	if( r8 == NULL ) hl_null_access();
	r7 = hl_vfields(r8)[2] ? (*(hl__types__ArrayObj*)(hl_vfields(r8)[2])) : (hl__types__ArrayObj)hl_dyn_getp(r8->value,239676598/*vars*/,&t$hl_types_ArrayObj);
	label$de0a185_1_12:
	if( r7 == NULL ) hl_null_access();
	r10 = r7->length;
	if( r6 >= r10 ) goto label$de0a185_1_31;
	r10 = r7->length;
	if( ((unsigned)r6) < ((unsigned)r10) ) goto label$de0a185_1_20;
	r11 = NULL;
	goto label$de0a185_1_23;
	label$de0a185_1_20:
	r13 = r7->array;
	r12 = ((vdynamic**)(r13 + 1))[r6];
	r11 = hl_to_virtual(&t$vrt_09f4a29,(vdynamic*)r12);
	label$de0a185_1_23:
	++r6;
	if( r11 == NULL ) hl_null_access();
	r3 = hl_vfields(r11)[2] ? (*(String*)(hl_vfields(r11)[2])) : (String)hl_dyn_getp(r11->value,150958933/*name*/,&t$String);
	if( r3 != r2 && (!r3 || !r2 || String___compare(r3,(vdynamic*)r2) != 0) ) goto label$de0a185_1_30;
	r15 = true;
	r5 = r15;
	goto label$de0a185_1_31;
	label$de0a185_1_30:
	goto label$de0a185_1_12;
	label$de0a185_1_31:
	if( r5 ) goto label$de0a185_1_38;
	r3 = (String)s$Shader_does_not_have_;
	r3 = String___add__(r3,r2);
	r14 = (String)s$_variable;
	r3 = String___add__(r3,r14);
	r12 = haxe_Exception_thrown(((vdynamic*)r3));
	hl_throw((vdynamic*)r12);
	label$de0a185_1_38:
	r0->textureParam = r2;
	r16 = (h3d__pass__ScreenFx)hl_alloc_obj(&t$h3d_pass_ScreenFx);
	r7 = NULL;
	h3d_pass_ScreenFx_new(r16,r1,r7);
	r0->pass = r16;
	return;
}

h3d__shader__ScreenShader h2d_filter_Shader_get_shader(h2d__filter__Shader r0) {
	h3d__shader__ScreenShader r1;
	h3d__pass__ScreenFx r2;
	r2 = r0->pass;
	if( r2 == NULL ) hl_null_access();
	r1 = r2->shader;
	return r1;
}

h2d__Tile h2d_filter_Shader_draw(h2d__filter__Shader r0,h2d__RenderContext r1,h2d__Tile r2) {
	bool *r7;
	String r5, r15;
	h3d__impl__TextureCache r4;
	h3d__shader__ScreenShader r14;
	venum *r8, *r17;
	bool r16;
	h2d__Tile r6;
	h3d__pass__ScreenFx r18;
	h3d__Engine r10;
	int *r12, *r13;
	h3d__mat__Texture r3, r11;
	if( r1 == NULL ) hl_null_access();
	r4 = r1->textures;
	if( r4 == NULL ) hl_null_access();
	r5 = (String)s$shaderTmp;
	r7 = NULL;
	r8 = NULL;
	r3 = h3d_impl_TextureCache_allocTileTarget(r4,r5,r2,r7,r8);
	r10 = r1->engine;
	if( r10 == NULL ) hl_null_access();
	r12 = NULL;
	r13 = NULL;
	h3d_Engine_pushTarget(r10,r3,r12,r13);
	r14 = h2d_filter_Shader_get_shader(r0);
	r5 = r0->textureParam;
	r15 = (String)s$__;
	r5 = String___add__(r5,r15);
	if( r2 == NULL ) hl_null_access();
	r11 = r2->innerTex;
	Reflect_setField(((vdynamic*)r14),r5,((vdynamic*)r11));
	r16 = r0->nearest;
	if( !r16 ) goto label$de0a185_3_25;
	r11 = r2->innerTex;
	if( r11 == NULL ) hl_null_access();
	r17 = (venum*)g$h3d_mat_Filter_Nearest;
	r17 = h3d_mat_Texture_set_filter(r11,r17);
	label$de0a185_3_25:
	r18 = r0->pass;
	if( r18 == NULL ) hl_null_access();
	h3d_pass_ScreenFx_render(r18);
	r10 = r1->engine;
	if( r10 == NULL ) hl_null_access();
	h3d_Engine_popTarget(r10);
	r6 = h2d_Tile_fromTexture(r3);
	return r6;
}

