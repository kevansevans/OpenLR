// Generated by HLC 4.1.5 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <hxd/Save.h>
extern String s$s_al_t;
String String___add__(String,String);
String haxe_crypto_Sha1_encode(String);
extern hl_type t$_i32;
String String_substr(String,int,vdynamic*);
vdynamic* String_charCodeAt(String,int);
extern String s$Missing_CRC;
vdynamic* haxe_Exception_thrown(vdynamic*);
int String___compare(String,vdynamic*);
extern String s$Invalid_CRC;
vdynamic* haxe_Unserializer_run(String);
String haxe_Serializer_run(vdynamic*);
extern String s$01abfc7;
extern String s$save;
extern hxd__$Save g$_hxd_Save;
extern String s$_sav;
String sys_io_File_getContent(String);
void sys_io_File_saveContent(String,String);
extern hl_type t$String;
extern hl_type t$_dyn;

String hxd_Save_makeCRC(String r0) {
	String r1, r2, r3;
	vdynamic *r6;
	int r4, r5;
	r3 = (String)s$s_al_t;
	r2 = String___add__(r0,r3);
	r2 = haxe_crypto_Sha1_encode(r2);
	r1 = String___add__(r0,r2);
	r1 = haxe_crypto_Sha1_encode(r1);
	if( r1 == NULL ) hl_null_access();
	r4 = 4;
	r5 = 32;
	r6 = hl_alloc_dynamic(&t$_i32);
	r6->v.i = r5;
	r1 = String_substr(r1,r4,r6);
	return r1;
}

vdynamic* hxd_Save_loadData(String r0,bool r1) {
	String r3, r5;
	vdynamic *r2, *r7, *r8;
	int r4, r6;
	if( !r1 ) goto label$bc1b389_2_27;
	if( r0 == NULL ) hl_null_access();
	r4 = r0->length;
	r6 = 33;
	r4 = r4 - r6;
	r2 = String_charCodeAt(r0,r4);
	r4 = 35;
	r7 = hl_alloc_dynamic(&t$_i32);
	r7->v.i = r4;
	if( r2 == r7 || (r2 && r7 && (r2->v.i == r7->v.i)) ) goto label$bc1b389_2_12;
	r3 = (String)s$Missing_CRC;
	r8 = haxe_Exception_thrown(((vdynamic*)r3));
	hl_throw((vdynamic*)r8);
	label$bc1b389_2_12:
	r4 = r0->length;
	r6 = 32;
	r4 = r4 - r6;
	r2 = NULL;
	r3 = String_substr(r0,r4,r2);
	r4 = 0;
	r6 = -33;
	r2 = hl_alloc_dynamic(&t$_i32);
	r2->v.i = r6;
	r5 = String_substr(r0,r4,r2);
	r0 = r5;
	r5 = hxd_Save_makeCRC(r5);
	if( r5 == r3 || (r5 && r3 && String___compare(r5,(vdynamic*)r3) == 0) ) goto label$bc1b389_2_27;
	r5 = (String)s$Invalid_CRC;
	r8 = haxe_Exception_thrown(((vdynamic*)r5));
	hl_throw((vdynamic*)r8);
	label$bc1b389_2_27:
	r8 = haxe_Unserializer_run(r0);
	return r8;
}

vdynamic* hxd_Save_saveData(vdynamic* r0,bool r1) {
	String r2, r3, r4;
	r2 = haxe_Serializer_run(r0);
	if( !r1 ) goto label$bc1b389_3_7;
	r4 = (String)s$01abfc7;
	r3 = String___add__(r2,r4);
	r4 = hxd_Save_makeCRC(r2);
	r3 = String___add__(r3,r4);
	return ((vdynamic*)r3);
	label$bc1b389_3_7:
	return ((vdynamic*)r2);
}

vdynamic* hxd_Save_load(vdynamic* r0,String r1,bool* r2) {
	String r3;
	hxd__$Save r7;
	bool r4;
	vclosure *r6;
	vdynamic *r5, *r8;
	hl_trap_ctx trap$0;
	if( r1 ) goto label$bc1b389_4_3;
	r3 = (String)s$save;
	r1 = r3;
	label$bc1b389_4_3:
	if( r2 ) goto label$bc1b389_4_6;
	r4 = false;
	goto label$bc1b389_4_7;
	label$bc1b389_4_6:
	r4 = *r2;
	label$bc1b389_4_7:
	hl_trap(trap$0,r5,label$bc1b389_4_16);
	r7 = (hxd__$Save)g$_hxd_Save;
	r6 = r7->readSaveData;
	if( r6 == NULL ) hl_null_access();
	r3 = r6->hasValue ? ((String (*)(vdynamic*,String))r6->fun)((vdynamic*)r6->value,r1) : ((String (*)(String))r6->fun)(r1);
	r5 = hxd_Save_loadData(r3,r4);
	hl_endtrap(trap$0);
	return r5;
	hl_endtrap(trap$0);
	label$bc1b389_4_16:
	r8 = NULL;
	return r0;
}

String hxd_Save_readSaveData(String r0) {
	String r1, r2;
	r2 = (String)s$_sav;
	r1 = String___add__(r0,r2);
	r1 = sys_io_File_getContent(r1);
	return r1;
}

void hxd_Save_writeSaveData(String r0,String r1) {
	String r3, r4;
	r4 = (String)s$_sav;
	r3 = String___add__(r0,r4);
	sys_io_File_saveContent(r3,r1);
	return;
}

bool hxd_Save_save(vdynamic* r0,String r1,bool* r2) {
	String r3, r8;
	hxd__$Save r10;
	bool r4, r6;
	vclosure *r9, *r12;
	vdynamic *r5, *r11;
	hl_trap_ctx trap$0;
	if( r1 ) goto label$bc1b389_7_3;
	r3 = (String)s$save;
	r1 = r3;
	label$bc1b389_7_3:
	if( r2 ) goto label$bc1b389_7_6;
	r4 = false;
	goto label$bc1b389_7_7;
	label$bc1b389_7_6:
	r4 = *r2;
	label$bc1b389_7_7:
	r5 = hxd_Save_saveData(r0,r4);
	r3 = (String)hl_dyn_castp(&r5,&t$_dyn,&t$String);
	hl_trap(trap$0,r5,label$bc1b389_7_20);
	r10 = (hxd__$Save)g$_hxd_Save;
	r9 = r10->readSaveData;
	if( r9 == NULL ) hl_null_access();
	r8 = r9->hasValue ? ((String (*)(vdynamic*,String))r9->fun)((vdynamic*)r9->value,r1) : ((String (*)(String))r9->fun)(r1);
	if( r8 != r3 && (!r8 || !r3 || String___compare(r8,(vdynamic*)r3) != 0) ) goto label$bc1b389_7_18;
	r6 = false;
	hl_endtrap(trap$0);
	return r6;
	label$bc1b389_7_18:
	hl_endtrap(trap$0);
	goto label$bc1b389_7_21;
	label$bc1b389_7_20:
	r11 = NULL;
	label$bc1b389_7_21:
	r10 = (hxd__$Save)g$_hxd_Save;
	r12 = r10->writeSaveData;
	if( r12 == NULL ) hl_null_access();
	r12->hasValue ? ((void (*)(vdynamic*,String,String))r12->fun)((vdynamic*)r12->value,r1,r3) : ((void (*)(String,String))r12->fun)(r1,r3);
	r6 = true;
	return r6;
}

