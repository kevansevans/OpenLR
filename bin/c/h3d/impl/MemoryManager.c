// Generated by HLC 4.1.4 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <h3d/impl/MemoryManager.h>
#include <h3d/mat/Texture.h>
extern hl_type t$h3d_mat_Texture;
extern hl_type t$_dyn;
extern hl_type t$hl_types_ArrayObj;
void hl_types_ArrayObj_new(hl__types__ArrayObj);
void h3d_impl_MemoryManager_initIndexes(h3d__impl__MemoryManager);
#include <hl/types/ArrayBytes_hl_UI16.h>
extern hl_type t$hl_types_ArrayBytes_hl_UI16;
void hl_types_ArrayBytes_hl_UI16_new(hl__types__ArrayBytes_hl_UI16);
void hl_types_ArrayBytes_hl_UI16___expand(hl__types__ArrayBytes_hl_UI16,int);
int hl_types_ArrayBytes_hl_UI16_push(hl__types__ArrayBytes_hl_UI16,unsigned short);
h3d__Indexes h3d_Indexes_alloc(hl__types__ArrayBytes_hl_UI16,int*,int*);
#include <h3d/impl/ManagedBuffer.h>
#include <h3d/impl/_ManagedBuffer/FreeCell.h>
void h3d_impl_ManagedBuffer_dispose(h3d__impl__ManagedBuffer);
void hl_types_ArrayObj___expand(hl__types__ArrayObj,int);
int h3d_impl_MemoryManager_freeMemorySize(h3d__impl__MemoryManager);
extern String s$Too_many_buffers;
vdynamic* haxe_Exception_thrown(vdynamic*);
extern String s$Memory_full_;
#include <hl/natives.h>
String String___alloc__(vbyte*,int);
String String___add__(String,String);
extern String s$_KB_;
extern String s$_buffers_;
#include <h3d/Buffer.h>
#include <h3d/BufferFlag.h>
extern String s$Cannot_split_buffer_with_;
extern String s$5b8c1a7;
extern hl_type t$h3d_BufferFlag;
hl__types__ArrayObj hl_types_ArrayObj_alloc(varray*);
extern h3d__impl__$MemoryManager g$_h3d_impl_MemoryManager;
int hl_types_ArrayObj_push(hl__types__ArrayObj,vdynamic*);
extern hl_type t$h3d_Buffer;
void h3d_Buffer_new(h3d__Buffer,int,int,hl__types__ArrayObj);
extern venum* g$h3d_BufferFlag_Dynamic;
extern venum* g$h3d_BufferFlag_UniformBuffer;
extern hl_type t$h3d_impl_ManagedBuffer;
void h3d_impl_ManagedBuffer_new(h3d__impl__ManagedBuffer,int,int,hl__types__ArrayObj);
bool h3d_impl_ManagedBuffer_allocBuffer(h3d__impl__ManagedBuffer,h3d__Buffer);
extern String s$assert;
extern venum* g$h3d_BufferFlag_Managed;
bool hl_types_ArrayObj_remove(hl__types__ArrayObj,vdynamic*);
#include <hxd/Timer.h>
int h3d_impl_MemoryManager_sortByLRU(h3d__impl__MemoryManager,h3d__mat__Texture,h3d__mat__Texture);
extern hl_type t$fun_6a85200;
extern hl_type t$fun_5f1efa7;
void hl_types_ArrayObj_sort(hl__types__ArrayObj,vclosure*);
int h3d_mat_Texture_get_lastFrame(h3d__mat__Texture);
extern hxd__$Timer g$_hxd_Timer;
void h3d_mat_Texture_dispose(h3d__mat__Texture);
extern String s$Maximum_texture_memory_reached;
#include <h3d/mat/DepthBuffer.h>
void h3d_impl_MemoryManager_dispose(h3d__impl__MemoryManager);
void h3d_Indexes_dispose(h3d__Indexes);
hl__types__ArrayObj hl_types_ArrayObj_copy(hl__types__ArrayObj);
void h3d_mat_DepthBuffer_dispose(h3d__mat__DepthBuffer);
extern hl_type t$h3d_Indexes;
extern hl_type t$fun_4bffad7;

int h3d_impl_MemoryManager_cleanTextures__$1(vclosure* r0,vdynamic* r1,vdynamic* r2) {
	int r5;
	h3d__mat__Texture r3, r4;
	r3 = (h3d__mat__Texture)hl_dyn_castp(&r1,&t$_dyn,&t$h3d_mat_Texture);
	r4 = (h3d__mat__Texture)hl_dyn_castp(&r2,&t$_dyn,&t$h3d_mat_Texture);
	r5 = r0->hasValue ? ((int (*)(vdynamic*,h3d__mat__Texture,h3d__mat__Texture))r0->fun)((vdynamic*)r0->value,r3,r4) : ((int (*)(h3d__mat__Texture,h3d__mat__Texture))r0->fun)(r3,r4);
	return r5;
}

void h3d_impl_MemoryManager_init(h3d__impl__MemoryManager r0) {
	hl__types__ArrayObj r1;
	r1 = (hl__types__ArrayObj)hl_alloc_obj(&t$hl_types_ArrayObj);
	hl_types_ArrayObj_new(r1);
	r0->indexes = r1;
	r1 = (hl__types__ArrayObj)hl_alloc_obj(&t$hl_types_ArrayObj);
	hl_types_ArrayObj_new(r1);
	r0->textures = r1;
	r1 = (hl__types__ArrayObj)hl_alloc_obj(&t$hl_types_ArrayObj);
	hl_types_ArrayObj_new(r1);
	r0->buffers = r1;
	r1 = (hl__types__ArrayObj)hl_alloc_obj(&t$hl_types_ArrayObj);
	hl_types_ArrayObj_new(r1);
	r0->depths = r1;
	h3d_impl_MemoryManager_initIndexes(r0);
	return;
}

void h3d_impl_MemoryManager_initIndexes(h3d__impl__MemoryManager r0) {
	hl__types__ArrayBytes_hl_UI16 r3, r6, r10, r14;
	unsigned short r7;
	int *r12, *r13;
	h3d__Indexes r11;
	vbyte *r9;
	int r1, r4, r5, r8, r15, r16, r17, r18, r19;
	r1 = 0;
	r3 = (hl__types__ArrayBytes_hl_UI16)hl_alloc_obj(&t$hl_types_ArrayBytes_hl_UI16);
	hl_types_ArrayBytes_hl_UI16_new(r3);
	r5 = 0;
	if( r5 >= r1 ) goto label$88467e8_3_19;
	r5 = r3->length;
	if( r5 >= r1 ) goto label$88467e8_3_19;
	r5 = 1;
	r4 = r1 - r5;
	r5 = 0;
	r7 = (int)r5;
	r5 = (int)r7;
	r8 = r3->length;
	if( ((unsigned)r4) < ((unsigned)r8) ) goto label$88467e8_3_15;
	hl_types_ArrayBytes_hl_UI16___expand(r3,r4);
	label$88467e8_3_15:
	r9 = r3->bytes;
	r8 = 1;
	r8 = r4 << r8;
	*(unsigned short*)(r9 + r8) = (unsigned short)r5;
	label$88467e8_3_19:
	r6 = r3;
	r4 = 0;
	label$88467e8_3_21:
	r8 = 65533;
	if( r4 >= r8 ) goto label$88467e8_3_30;
	r5 = r4;
	++r4;
	if( r6 == NULL ) hl_null_access();
	r7 = (int)r5;
	r8 = hl_types_ArrayBytes_hl_UI16_push(r6,r7);
	goto label$88467e8_3_21;
	label$88467e8_3_30:
	r12 = NULL;
	r13 = NULL;
	r11 = h3d_Indexes_alloc(r6,r12,r13);
	r0->triIndexes = r11;
	r4 = 0;
	r10 = (hl__types__ArrayBytes_hl_UI16)hl_alloc_obj(&t$hl_types_ArrayBytes_hl_UI16);
	hl_types_ArrayBytes_hl_UI16_new(r10);
	r8 = 0;
	if( r8 >= r4 ) goto label$88467e8_3_53;
	r8 = r10->length;
	if( r8 >= r4 ) goto label$88467e8_3_53;
	r8 = 1;
	r5 = r4 - r8;
	r8 = 0;
	r7 = (int)r8;
	r8 = (int)r7;
	r15 = r10->length;
	if( ((unsigned)r5) < ((unsigned)r15) ) goto label$88467e8_3_49;
	hl_types_ArrayBytes_hl_UI16___expand(r10,r5);
	label$88467e8_3_49:
	r9 = r10->bytes;
	r15 = 1;
	r15 = r5 << r15;
	*(unsigned short*)(r9 + r15) = (unsigned short)r8;
	label$88467e8_3_53:
	r14 = r10;
	r5 = 0;
	r8 = 0;
	r15 = 16383;
	label$88467e8_3_57:
	if( r8 >= r15 ) goto label$88467e8_3_87;
	r16 = r8;
	++r8;
	r18 = 2;
	r17 = r16 << r18;
	if( r14 == NULL ) hl_null_access();
	r7 = (int)r17;
	r18 = hl_types_ArrayBytes_hl_UI16_push(r14,r7);
	r19 = 1;
	r18 = r17 + r19;
	r7 = (int)r18;
	r18 = hl_types_ArrayBytes_hl_UI16_push(r14,r7);
	r19 = 2;
	r18 = r17 + r19;
	r7 = (int)r18;
	r18 = hl_types_ArrayBytes_hl_UI16_push(r14,r7);
	r19 = 2;
	r18 = r17 + r19;
	r7 = (int)r18;
	r18 = hl_types_ArrayBytes_hl_UI16_push(r14,r7);
	r19 = 1;
	r18 = r17 + r19;
	r7 = (int)r18;
	r18 = hl_types_ArrayBytes_hl_UI16_push(r14,r7);
	r19 = 3;
	r18 = r17 + r19;
	r7 = (int)r18;
	r18 = hl_types_ArrayBytes_hl_UI16_push(r14,r7);
	goto label$88467e8_3_57;
	label$88467e8_3_87:
	if( r14 == NULL ) hl_null_access();
	r8 = 65533;
	r7 = (int)r8;
	r8 = hl_types_ArrayBytes_hl_UI16_push(r14,r7);
	r12 = NULL;
	r13 = NULL;
	r11 = h3d_Indexes_alloc(r14,r12,r13);
	r0->quadIndexes = r11;
	return;
}

void h3d_impl_MemoryManager_garbage(h3d__impl__MemoryManager r0) {
	return;
}

void h3d_impl_MemoryManager_cleanManagedBuffers(h3d__impl__MemoryManager r0) {
	hl__types__ArrayObj r4;
	h3d__impl___ManagedBuffer__FreeCell r13;
	vdynamic *r9;
	varray *r10;
	h3d__impl__ManagedBuffer r8, r11, r12, r14;
	int r1, r3, r5, r6, r7;
	r1 = 1;
	r4 = r0->buffers;
	if( r4 == NULL ) hl_null_access();
	r3 = r4->length;
	label$88467e8_5_4:
	if( r1 >= r3 ) goto label$88467e8_5_46;
	r5 = r1;
	++r1;
	r4 = r0->buffers;
	if( r4 == NULL ) hl_null_access();
	r7 = r4->length;
	if( ((unsigned)r5) < ((unsigned)r7) ) goto label$88467e8_5_14;
	r8 = NULL;
	goto label$88467e8_5_17;
	label$88467e8_5_14:
	r10 = r4->array;
	r9 = ((vdynamic**)(r10 + 1))[r5];
	r8 = (h3d__impl__ManagedBuffer)r9;
	label$88467e8_5_17:
	r11 = NULL;
	label$88467e8_5_18:
	if( !r8 ) goto label$88467e8_5_45;
	if( r8 == NULL ) hl_null_access();
	r13 = r8->freeList;
	if( r13 == NULL ) hl_null_access();
	r6 = r13->count;
	r7 = r8->size;
	if( r6 != r7 ) goto label$88467e8_5_41;
	h3d_impl_ManagedBuffer_dispose(r8);
	if( r11 ) goto label$88467e8_5_37;
	r4 = r0->buffers;
	if( r4 == NULL ) hl_null_access();
	r12 = r8->next;
	r7 = r4->length;
	if( ((unsigned)r5) < ((unsigned)r7) ) goto label$88467e8_5_34;
	hl_types_ArrayObj___expand(r4,r5);
	label$88467e8_5_34:
	r10 = r4->array;
	((h3d__impl__ManagedBuffer*)(r10 + 1))[r5] = r12;
	goto label$88467e8_5_40;
	label$88467e8_5_37:
	if( r11 == NULL ) hl_null_access();
	r14 = r8->next;
	r11->next = r14;
	label$88467e8_5_40:
	goto label$88467e8_5_42;
	label$88467e8_5_41:
	r11 = r8;
	label$88467e8_5_42:
	r12 = r8->next;
	r8 = r12;
	goto label$88467e8_5_18;
	label$88467e8_5_45:
	goto label$88467e8_5_4;
	label$88467e8_5_46:
	return;
}

void h3d_impl_MemoryManager_allocManaged(h3d__impl__MemoryManager r0,h3d__impl__ManagedBuffer r1) {
	String r14, r17;
	vvirtual *r3;
	bool r11;
	vclosure *r12;
	double r8, r9, r13;
	int *r15;
	h3d__impl__Driver r10;
	vdynamic *r4;
	vbyte *r16;
	int r5, r6, r7;
	if( r1 == NULL ) hl_null_access();
	r3 = r1->vbuf;
	if( !r3 ) goto label$88467e8_6_4;
	return;
	label$88467e8_6_4:
	r5 = r1->size;
	r6 = r1->stride;
	r5 = r5 * r6;
	r6 = 4;
	r5 = r5 * r6;
	r7 = 0;
	if( r5 != r7 ) goto label$88467e8_6_12;
	return;
	label$88467e8_6_12:
	r8 = r0->usedMemory;
	r9 = (double)r5;
	r8 = r8 + r9;
	r9 = 4294967296.;
	if( r9 < r8 ) goto label$88467e8_6_27;
	r6 = r0->bufferCount;
	r7 = 65536;
	if( r6 >= r7 ) goto label$88467e8_6_27;
	if( r1 == NULL ) hl_null_access();
	r10 = r0->driver;
	if( r10 == NULL ) hl_null_access();
	r3 = ((vvirtual* (*)(h3d__impl__Driver,h3d__impl__ManagedBuffer))r10->$type->vobj_proto[25])(r10,r1);
	r1->vbuf = r3;
	if( r3 ) goto label$88467e8_6_71;
	label$88467e8_6_27:
	r10 = r0->driver;
	if( r10 == NULL ) hl_null_access();
	r11 = ((bool (*)(h3d__impl__Driver))r10->$type->vobj_proto[3])(r10);
	if( !r11 ) goto label$88467e8_6_32;
	return;
	label$88467e8_6_32:
	r8 = r0->usedMemory;
	r6 = h3d_impl_MemoryManager_freeMemorySize(r0);
	r9 = (double)r6;
	r8 = r8 - r9;
	r12 = r0->garbage;
	if( r12 == NULL ) hl_null_access();
	r12->hasValue ? ((void (*)(vdynamic*))r12->fun)((vdynamic*)r12->value) : ((void (*)(void))r12->fun)();
	h3d_impl_MemoryManager_cleanManagedBuffers(r0);
	r9 = r0->usedMemory;
	r6 = h3d_impl_MemoryManager_freeMemorySize(r0);
	r13 = (double)r6;
	r9 = r9 - r13;
	if( r9 != r8 ) goto label$88467e8_6_70;
	r6 = r0->bufferCount;
	r7 = 65536;
	if( r6 < r7 ) goto label$88467e8_6_51;
	r14 = (String)s$Too_many_buffers;
	r4 = haxe_Exception_thrown(((vdynamic*)r14));
	hl_throw((vdynamic*)r4);
	label$88467e8_6_51:
	r14 = (String)s$Memory_full_;
	r13 = 1024.;
	r9 = r8 / r13;
	r9 = hl_math_fceil(r9);
	r15 = &r6;
	r16 = hl_ftos(r9,r15);
	r17 = String___alloc__(r16,r6);
	r14 = String___add__(r14,r17);
	r17 = (String)s$_KB_;
	r14 = String___add__(r14,r17);
	r6 = r0->bufferCount;
	r15 = &r6;
	r16 = hl_itos(r6,r15);
	r17 = String___alloc__(r16,r6);
	r14 = String___add__(r14,r17);
	r17 = (String)s$_buffers_;
	r14 = String___add__(r14,r17);
	r4 = haxe_Exception_thrown(((vdynamic*)r14));
	hl_throw((vdynamic*)r4);
	label$88467e8_6_70:
	goto label$88467e8_6_12;
	label$88467e8_6_71:
	r8 = r0->usedMemory;
	r9 = (double)r5;
	r8 = r8 + r9;
	r0->usedMemory = r8;
	r6 = r0->bufferCount;
	++r6;
	r0->bufferCount = r6;
	return;
}

void h3d_impl_MemoryManager_freeManaged(h3d__impl__MemoryManager r0,h3d__impl__ManagedBuffer r1) {
	hl__types__ArrayObj r11;
	vvirtual *r3;
	double r7, r10;
	h3d__impl__Driver r6;
	vdynamic *r5;
	varray *r12;
	int r8, r9;
	h3d__impl__ManagedBuffer r4, r13, r14, r15;
	if( r1 == NULL ) hl_null_access();
	r3 = r1->vbuf;
	if( r3 ) goto label$88467e8_7_4;
	return;
	label$88467e8_7_4:
	r6 = r0->driver;
	if( r6 == NULL ) hl_null_access();
	r3 = r1->vbuf;
	((void (*)(h3d__impl__Driver,vvirtual*))r6->$type->vobj_proto[28])(r6,r3);
	r3 = NULL;
	r1->vbuf = r3;
	r7 = r0->usedMemory;
	r8 = r1->size;
	r9 = r1->stride;
	r8 = r8 * r9;
	r9 = 4;
	r8 = r8 * r9;
	r10 = (double)r8;
	r7 = r7 - r10;
	r0->usedMemory = r7;
	r8 = r0->bufferCount;
	--r8;
	r0->bufferCount = r8;
	r8 = r1->flags;
	r9 = 8;
	r8 = r8 & r9;
	r9 = 0;
	if( r8 != r9 ) goto label$88467e8_7_63;
	r11 = r0->buffers;
	if( r11 == NULL ) hl_null_access();
	r8 = 0;
	r9 = r11->length;
	if( ((unsigned)r8) < ((unsigned)r9) ) goto label$88467e8_7_34;
	r4 = NULL;
	goto label$88467e8_7_37;
	label$88467e8_7_34:
	r12 = r11->array;
	r5 = ((vdynamic**)(r12 + 1))[r8];
	r4 = (h3d__impl__ManagedBuffer)r5;
	label$88467e8_7_37:
	r13 = NULL;
	label$88467e8_7_38:
	if( !r4 ) goto label$88467e8_7_63;
	if( r4 != r1 ) goto label$88467e8_7_58;
	if( r13 ) goto label$88467e8_7_53;
	r11 = r0->buffers;
	if( r11 == NULL ) hl_null_access();
	r8 = 0;
	if( r1 == NULL ) hl_null_access();
	r14 = r1->next;
	r9 = r11->length;
	if( ((unsigned)r8) < ((unsigned)r9) ) goto label$88467e8_7_50;
	hl_types_ArrayObj___expand(r11,r8);
	label$88467e8_7_50:
	r12 = r11->array;
	((h3d__impl__ManagedBuffer*)(r12 + 1))[r8] = r14;
	goto label$88467e8_7_57;
	label$88467e8_7_53:
	if( r13 == NULL ) hl_null_access();
	if( r1 == NULL ) hl_null_access();
	r15 = r1->next;
	r13->next = r15;
	label$88467e8_7_57:
	goto label$88467e8_7_63;
	label$88467e8_7_58:
	r13 = r4;
	if( r4 == NULL ) hl_null_access();
	r14 = r4->next;
	r4 = r14;
	goto label$88467e8_7_38;
	label$88467e8_7_63:
	return;
}

void h3d_impl_MemoryManager_allocBuffer(h3d__impl__MemoryManager r0,h3d__Buffer r1,int r2) {
	String r9, r12;
	hl__types__ArrayObj r14, r17;
	venum *r21;
	hl_type *r16;
	bool r27;
	h3d__impl__$MemoryManager r18;
	h3d__Buffer r4, r13, r23;
	int *r10;
	vdynamic *r8;
	h3d__impl__ManagedBuffer r24, r25, r26;
	varray *r15;
	vbyte *r11;
	int r3, r5, r7, r19, r20, r22, r28, r29;
	if( r1 == NULL ) hl_null_access();
	r3 = r1->flags;
	r5 = 4;
	r3 = r3 & r5;
	r5 = 0;
	if( r3 == r5 ) goto label$88467e8_8_8;
	r3 = 65532;
	goto label$88467e8_8_16;
	label$88467e8_8_8:
	r3 = r1->flags;
	r5 = 2;
	r3 = r3 & r5;
	r5 = 0;
	if( r3 == r5 ) goto label$88467e8_8_15;
	r3 = 65533;
	goto label$88467e8_8_16;
	label$88467e8_8_15:
	r3 = 65534;
	label$88467e8_8_16:
	r5 = r1->vertices;
	if( r3 >= r5 ) goto label$88467e8_8_88;
	r5 = r1->flags;
	r7 = 64;
	r5 = r5 & r7;
	r7 = 0;
	if( r5 != r7 ) goto label$88467e8_8_88;
	r5 = r1->flags;
	r7 = 128;
	r5 = r5 & r7;
	r7 = 0;
	if( r5 != r7 ) goto label$88467e8_8_88;
	r7 = 65534;
	if( r3 != r7 ) goto label$88467e8_8_40;
	r9 = (String)s$Cannot_split_buffer_with_;
	r5 = r1->vertices;
	r10 = &r5;
	r11 = hl_itos(r5,r10);
	r12 = String___alloc__(r11,r5);
	r9 = String___add__(r9,r12);
	r12 = (String)s$5b8c1a7;
	r9 = String___add__(r9,r12);
	r8 = haxe_Exception_thrown(((vdynamic*)r9));
	hl_throw((vdynamic*)r8);
	label$88467e8_8_40:
	r5 = r1->vertices;
	r5 = r5 - r3;
	r1->vertices = r3;
	h3d_impl_MemoryManager_allocBuffer(r0,r1,r2);
	r4 = r1;
	label$88467e8_8_45:
	if( r4 == NULL ) hl_null_access();
	r13 = r4->next;
	if( !r13 ) goto label$88467e8_8_52;
	r13 = r4->next;
	r4 = r13;
	goto label$88467e8_8_45;
	label$88467e8_8_52:
	r16 = &t$h3d_BufferFlag;
	r7 = 0;
	r15 = hl_alloc_array(r16,r7);
	r14 = hl_types_ArrayObj_alloc(r15);
	r7 = 0;
	r18 = (h3d__impl__$MemoryManager)g$_h3d_impl_MemoryManager;
	r17 = r18->ALL_FLAGS;
	label$88467e8_8_59:
	if( r17 == NULL ) hl_null_access();
	r20 = r17->length;
	if( r7 >= r20 ) goto label$88467e8_8_83;
	r20 = r17->length;
	if( ((unsigned)r7) < ((unsigned)r20) ) goto label$88467e8_8_67;
	r21 = NULL;
	goto label$88467e8_8_70;
	label$88467e8_8_67:
	r15 = r17->array;
	r8 = ((vdynamic**)(r15 + 1))[r7];
	r21 = (venum*)r8;
	label$88467e8_8_70:
	++r7;
	if( r1 == NULL ) hl_null_access();
	r19 = r1->flags;
	r20 = 1;
	if( r21 == NULL ) hl_null_access();
	r22 = HL__ENUM_INDEX__(r21);
	r20 = r20 << r22;
	r19 = r19 & r20;
	r20 = 0;
	if( r19 == r20 ) goto label$88467e8_8_82;
	if( r14 == NULL ) hl_null_access();
	r19 = hl_types_ArrayObj_push(r14,((vdynamic*)r21));
	label$88467e8_8_82:
	goto label$88467e8_8_59;
	label$88467e8_8_83:
	if( r4 == NULL ) hl_null_access();
	r23 = (h3d__Buffer)hl_alloc_obj(&t$h3d_Buffer);
	h3d_Buffer_new(r23,r5,r2,r14);
	r4->next = r23;
	return;
	label$88467e8_8_88:
	r5 = r1->flags;
	r7 = 8;
	r5 = r5 & r7;
	r7 = 0;
	if( r5 != r7 ) goto label$88467e8_8_150;
	r14 = NULL;
	r5 = r1->flags;
	r7 = 1;
	r5 = r5 & r7;
	r7 = 0;
	if( r5 == r7 ) goto label$88467e8_8_108;
	if( r14 ) goto label$88467e8_8_105;
	r16 = &t$h3d_BufferFlag;
	r5 = 0;
	r15 = hl_alloc_array(r16,r5);
	r17 = hl_types_ArrayObj_alloc(r15);
	r14 = r17;
	label$88467e8_8_105:
	if( r14 == NULL ) hl_null_access();
	r21 = (venum*)g$h3d_BufferFlag_Dynamic;
	r5 = hl_types_ArrayObj_push(r14,((vdynamic*)r21));
	label$88467e8_8_108:
	r5 = r1->flags;
	r7 = 64;
	r5 = r5 & r7;
	r7 = 0;
	if( r5 == r7 ) goto label$88467e8_8_122;
	if( r14 ) goto label$88467e8_8_119;
	r16 = &t$h3d_BufferFlag;
	r5 = 0;
	r15 = hl_alloc_array(r16,r5);
	r17 = hl_types_ArrayObj_alloc(r15);
	r14 = r17;
	label$88467e8_8_119:
	if( r14 == NULL ) hl_null_access();
	r21 = (venum*)g$h3d_BufferFlag_UniformBuffer;
	r5 = hl_types_ArrayObj_push(r14,((vdynamic*)r21));
	label$88467e8_8_122:
	r24 = (h3d__impl__ManagedBuffer)hl_alloc_obj(&t$h3d_impl_ManagedBuffer);
	r7 = r1->vertices;
	h3d_impl_ManagedBuffer_new(r24,r2,r7,r14);
	r17 = r0->buffers;
	if( r17 == NULL ) hl_null_access();
	r5 = 0;
	r7 = r17->length;
	if( ((unsigned)r5) < ((unsigned)r7) ) goto label$88467e8_8_132;
	r26 = NULL;
	goto label$88467e8_8_135;
	label$88467e8_8_132:
	r15 = r17->array;
	r8 = ((vdynamic**)(r15 + 1))[r5];
	r26 = (h3d__impl__ManagedBuffer)r8;
	label$88467e8_8_135:
	r24->next = r26;
	r17 = r0->buffers;
	if( r17 == NULL ) hl_null_access();
	r5 = 0;
	r7 = r17->length;
	if( ((unsigned)r5) < ((unsigned)r7) ) goto label$88467e8_8_142;
	hl_types_ArrayObj___expand(r17,r5);
	label$88467e8_8_142:
	r15 = r17->array;
	((h3d__impl__ManagedBuffer*)(r15 + 1))[r5] = r24;
	r27 = h3d_impl_ManagedBuffer_allocBuffer(r24,r1);
	if( r27 ) goto label$88467e8_8_149;
	r9 = (String)s$assert;
	r8 = haxe_Exception_thrown(((vdynamic*)r9));
	hl_throw((vdynamic*)r8);
	label$88467e8_8_149:
	return;
	label$88467e8_8_150:
	r14 = r0->buffers;
	if( r14 == NULL ) hl_null_access();
	r7 = r14->length;
	if( ((unsigned)r2) < ((unsigned)r7) ) goto label$88467e8_8_156;
	r24 = NULL;
	goto label$88467e8_8_159;
	label$88467e8_8_156:
	r15 = r14->array;
	r8 = ((vdynamic**)(r15 + 1))[r2];
	r24 = (h3d__impl__ManagedBuffer)r8;
	label$88467e8_8_159:
	r25 = NULL;
	label$88467e8_8_160:
	if( !r24 ) goto label$88467e8_8_170;
	if( r24 == NULL ) hl_null_access();
	r27 = h3d_impl_ManagedBuffer_allocBuffer(r24,r1);
	if( !r27 ) goto label$88467e8_8_166;
	return;
	label$88467e8_8_166:
	r25 = r24;
	r26 = r24->next;
	r24 = r26;
	goto label$88467e8_8_160;
	label$88467e8_8_170:
	if( r1 == NULL ) hl_null_access();
	r5 = r1->flags;
	r7 = 2;
	r5 = r5 & r7;
	r7 = 0;
	if( r5 == r7 ) goto label$88467e8_8_178;
	r5 = 3;
	goto label$88467e8_8_186;
	label$88467e8_8_178:
	r5 = r1->flags;
	r7 = 4;
	r5 = r5 & r7;
	r7 = 0;
	if( r5 == r7 ) goto label$88467e8_8_185;
	r5 = 4;
	goto label$88467e8_8_186;
	label$88467e8_8_185:
	r5 = 0;
	label$88467e8_8_186:
	if( r24 ) goto label$88467e8_8_259;
	r19 = 0;
	if( r19 >= r5 ) goto label$88467e8_8_259;
	r7 = r1->vertices;
	r19 = r7;
	label$88467e8_8_191:
	r22 = 2048;
	if( r22 >= r19 ) goto label$88467e8_8_257;
	r14 = r0->buffers;
	if( r14 == NULL ) hl_null_access();
	r22 = r14->length;
	if( ((unsigned)r2) < ((unsigned)r22) ) goto label$88467e8_8_200;
	r26 = NULL;
	goto label$88467e8_8_203;
	label$88467e8_8_200:
	r15 = r14->array;
	r8 = ((vdynamic**)(r15 + 1))[r2];
	r26 = (h3d__impl__ManagedBuffer)r8;
	label$88467e8_8_203:
	r24 = r26;
	r22 = 1;
	r20 = r19 >> r22;
	r22 = r5 == 0 ? 0 : r20 % r5;
	r20 = r20 - r22;
	r19 = r20;
	if( r1 == NULL ) hl_null_access();
	r1->vertices = r20;
	label$88467e8_8_211:
	if( !r24 ) goto label$88467e8_8_256;
	if( r24 == NULL ) hl_null_access();
	r27 = h3d_impl_ManagedBuffer_allocBuffer(r24,r1);
	if( !r27 ) goto label$88467e8_8_253;
	r16 = &t$h3d_BufferFlag;
	r20 = 0;
	r15 = hl_alloc_array(r16,r20);
	r14 = hl_types_ArrayObj_alloc(r15);
	r20 = 0;
	r18 = (h3d__impl__$MemoryManager)g$_h3d_impl_MemoryManager;
	r17 = r18->ALL_FLAGS;
	label$88467e8_8_223:
	if( r17 == NULL ) hl_null_access();
	r28 = r17->length;
	if( r20 >= r28 ) goto label$88467e8_8_247;
	r28 = r17->length;
	if( ((unsigned)r20) < ((unsigned)r28) ) goto label$88467e8_8_231;
	r21 = NULL;
	goto label$88467e8_8_234;
	label$88467e8_8_231:
	r15 = r17->array;
	r8 = ((vdynamic**)(r15 + 1))[r20];
	r21 = (venum*)r8;
	label$88467e8_8_234:
	++r20;
	if( r1 == NULL ) hl_null_access();
	r22 = r1->flags;
	r28 = 1;
	if( r21 == NULL ) hl_null_access();
	r29 = HL__ENUM_INDEX__(r21);
	r28 = r28 << r29;
	r22 = r22 & r28;
	r28 = 0;
	if( r22 == r28 ) goto label$88467e8_8_246;
	if( r14 == NULL ) hl_null_access();
	r22 = hl_types_ArrayObj_push(r14,((vdynamic*)r21));
	label$88467e8_8_246:
	goto label$88467e8_8_223;
	label$88467e8_8_247:
	if( r1 == NULL ) hl_null_access();
	r13 = (h3d__Buffer)hl_alloc_obj(&t$h3d_Buffer);
	r20 = r7 - r19;
	h3d_Buffer_new(r13,r20,r2,r14);
	r1->next = r13;
	return;
	label$88467e8_8_253:
	r26 = r24->next;
	r24 = r26;
	goto label$88467e8_8_211;
	label$88467e8_8_256:
	goto label$88467e8_8_191;
	label$88467e8_8_257:
	if( r1 == NULL ) hl_null_access();
	r1->vertices = r7;
	label$88467e8_8_259:
	r26 = (h3d__impl__ManagedBuffer)hl_alloc_obj(&t$h3d_impl_ManagedBuffer);
	r19 = 65533;
	r16 = &t$h3d_BufferFlag;
	r20 = 1;
	r15 = hl_alloc_array(r16,r20);
	r21 = (venum*)g$h3d_BufferFlag_Managed;
	r20 = 0;
	((venum**)(r15 + 1))[r20] = r21;
	r14 = hl_types_ArrayObj_alloc(r15);
	h3d_impl_ManagedBuffer_new(r26,r2,r19,r14);
	r24 = r26;
	if( r25 ) goto label$88467e8_8_279;
	r14 = r0->buffers;
	if( r14 == NULL ) hl_null_access();
	r19 = r14->length;
	if( ((unsigned)r2) < ((unsigned)r19) ) goto label$88467e8_8_276;
	hl_types_ArrayObj___expand(r14,r2);
	label$88467e8_8_276:
	r15 = r14->array;
	((h3d__impl__ManagedBuffer*)(r15 + 1))[r2] = r24;
	goto label$88467e8_8_281;
	label$88467e8_8_279:
	if( r25 == NULL ) hl_null_access();
	r25->next = r24;
	label$88467e8_8_281:
	r27 = h3d_impl_ManagedBuffer_allocBuffer(r24,r1);
	if( r27 ) goto label$88467e8_8_286;
	r9 = (String)s$assert;
	r8 = haxe_Exception_thrown(((vdynamic*)r9));
	hl_throw((vdynamic*)r8);
	label$88467e8_8_286:
	return;
}

void h3d_impl_MemoryManager_deleteIndexes(h3d__impl__MemoryManager r0,h3d__Indexes r1) {
	vvirtual *r6;
	hl__types__ArrayObj r3;
	bool r2;
	double r7, r10;
	h3d__impl__Driver r5;
	int r8, r9;
	r3 = r0->indexes;
	if( r3 == NULL ) hl_null_access();
	r2 = hl_types_ArrayObj_remove(r3,((vdynamic*)r1));
	r5 = r0->driver;
	if( r5 == NULL ) hl_null_access();
	if( r1 == NULL ) hl_null_access();
	r6 = r1->ibuf;
	((void (*)(h3d__impl__Driver,vvirtual*))r5->$type->vobj_proto[27])(r5,r6);
	r6 = NULL;
	r1->ibuf = r6;
	r7 = r0->usedMemory;
	r8 = r1->count;
	r2 = r1->is32;
	if( !r2 ) goto label$88467e8_9_16;
	r9 = 4;
	goto label$88467e8_9_17;
	label$88467e8_9_16:
	r9 = 2;
	label$88467e8_9_17:
	r8 = r8 * r9;
	r10 = (double)r8;
	r7 = r7 - r10;
	r0->usedMemory = r7;
	return;
}

void h3d_impl_MemoryManager_allocIndexes(h3d__impl__MemoryManager r0,h3d__Indexes r1) {
	hl__types__ArrayObj r6;
	vvirtual *r2;
	bool r5;
	double r7, r9;
	h3d__impl__Driver r3;
	int r4, r8;
	if( r1 == NULL ) hl_null_access();
	r3 = r0->driver;
	if( r3 == NULL ) hl_null_access();
	r4 = r1->count;
	r5 = r1->is32;
	r2 = ((vvirtual* (*)(h3d__impl__Driver,int,bool))r3->$type->vobj_proto[24])(r3,r4,r5);
	r1->ibuf = r2;
	r6 = r0->indexes;
	if( r6 == NULL ) hl_null_access();
	r4 = hl_types_ArrayObj_push(r6,((vdynamic*)r1));
	r7 = r0->usedMemory;
	r4 = r1->count;
	r5 = r1->is32;
	if( !r5 ) goto label$88467e8_10_16;
	r8 = 4;
	goto label$88467e8_10_17;
	label$88467e8_10_16:
	r8 = 2;
	label$88467e8_10_17:
	r4 = r4 * r8;
	r9 = (double)r4;
	r7 = r7 + r9;
	r0->usedMemory = r7;
	return;
}

int h3d_impl_MemoryManager_bpp(h3d__impl__MemoryManager r0,h3d__mat__Texture r1) {
	int r2;
	r2 = 4;
	return r2;
}

bool h3d_impl_MemoryManager_cleanTextures(h3d__impl__MemoryManager r0,bool* r1) {
	vvirtual *r14;
	hl__types__ArrayObj r4;
	bool r2, r15;
	hxd__$Timer r16;
	vclosure *r5, *r6, *r13;
	vdynamic *r11;
	varray *r12;
	h3d__mat__Texture r10;
	int r7, r8, r9, r17;
	if( r1 ) goto label$88467e8_12_3;
	r2 = true;
	goto label$88467e8_12_4;
	label$88467e8_12_3:
	r2 = *r1;
	label$88467e8_12_4:
	r4 = r0->textures;
	if( r4 == NULL ) hl_null_access();
	r5 = hl_alloc_closure_ptr(&t$fun_6a85200,h3d_impl_MemoryManager_sortByLRU,r0);
	if( r5 ) goto label$88467e8_12_10;
	r6 = NULL;
	goto label$88467e8_12_11;
	label$88467e8_12_10:
	r6 = hl_alloc_closure_ptr(&t$fun_5f1efa7,h3d_impl_MemoryManager_cleanTextures__$1,r5);
	label$88467e8_12_11:
	hl_types_ArrayObj_sort(r4,r6);
	r7 = 0;
	r4 = r0->textures;
	label$88467e8_12_14:
	if( r4 == NULL ) hl_null_access();
	r9 = r4->length;
	if( r7 >= r9 ) goto label$88467e8_12_45;
	r9 = r4->length;
	if( ((unsigned)r7) < ((unsigned)r9) ) goto label$88467e8_12_22;
	r10 = NULL;
	goto label$88467e8_12_25;
	label$88467e8_12_22:
	r12 = r4->array;
	r11 = ((vdynamic**)(r12 + 1))[r7];
	r10 = (h3d__mat__Texture)r11;
	label$88467e8_12_25:
	++r7;
	if( r10 == NULL ) hl_null_access();
	r13 = r10->realloc;
	if( !r13 ) goto label$88467e8_12_33;
	r14 = r10->_t;
	if( r14 ) goto label$88467e8_12_34;
	r13 = r10->realloc;
	if( r13 ) goto label$88467e8_12_34;
	label$88467e8_12_33:
	goto label$88467e8_12_14;
	label$88467e8_12_34:
	if( r2 ) goto label$88467e8_12_41;
	r8 = h3d_mat_Texture_get_lastFrame(r10);
	r16 = (hxd__$Timer)g$_hxd_Timer;
	r9 = r16->frameCount;
	r17 = 3600;
	r9 = r9 - r17;
	if( r8 >= r9 ) goto label$88467e8_12_44;
	label$88467e8_12_41:
	h3d_mat_Texture_dispose(r10);
	r15 = true;
	return r15;
	label$88467e8_12_44:
	goto label$88467e8_12_14;
	label$88467e8_12_45:
	r15 = false;
	return r15;
}

int h3d_impl_MemoryManager_sortByLRU(h3d__impl__MemoryManager r0,h3d__mat__Texture r1,h3d__mat__Texture r2) {
	int r3, r4;
	if( r1 == NULL ) hl_null_access();
	r3 = h3d_mat_Texture_get_lastFrame(r1);
	if( r2 == NULL ) hl_null_access();
	r4 = h3d_mat_Texture_get_lastFrame(r2);
	r3 = r3 - r4;
	return r3;
}

void h3d_impl_MemoryManager_deleteTexture(h3d__impl__MemoryManager r0,h3d__mat__Texture r1) {
	hl__types__ArrayObj r4;
	bool r3;
	double r6, r9;
	h3d__impl__Driver r5;
	int r7, r8;
	r4 = r0->textures;
	if( r4 == NULL ) hl_null_access();
	r3 = hl_types_ArrayObj_remove(r4,((vdynamic*)r1));
	if( r3 ) goto label$88467e8_14_5;
	return;
	label$88467e8_14_5:
	r5 = r0->driver;
	if( r5 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,h3d__mat__Texture))r5->$type->vobj_proto[26])(r5,r1);
	r6 = r0->texMemory;
	if( r1 == NULL ) hl_null_access();
	r7 = r1->width;
	r8 = r1->height;
	r7 = r7 * r8;
	r8 = h3d_impl_MemoryManager_bpp(r0,r1);
	r7 = r7 * r8;
	r9 = (double)r7;
	r6 = r6 - r9;
	r0->texMemory = r6;
	return;
}

void h3d_impl_MemoryManager_allocTexture(h3d__impl__MemoryManager r0,h3d__mat__Texture r1) {
	String r9;
	bool *r3;
	hl__types__ArrayObj r11;
	vvirtual *r5;
	bool r2, r7;
	double r12, r14;
	vdynamic *r8;
	h3d__impl__Driver r6;
	int r10, r13;
	r2 = false;
	r3 = &r2;
	r2 = h3d_impl_MemoryManager_cleanTextures(r0,r3);
	if( r1 == NULL ) hl_null_access();
	r6 = r0->driver;
	if( r6 == NULL ) hl_null_access();
	r5 = ((vvirtual* (*)(h3d__impl__Driver,h3d__mat__Texture))r6->$type->vobj_proto[23])(r6,r1);
	r1->_t = r5;
	r5 = r1->_t;
	if( r5 ) goto label$88467e8_15_24;
	r6 = r0->driver;
	if( r6 == NULL ) hl_null_access();
	r7 = ((bool (*)(h3d__impl__Driver))r6->$type->vobj_proto[3])(r6);
	if( !r7 ) goto label$88467e8_15_15;
	return;
	label$88467e8_15_15:
	r7 = true;
	r3 = &r7;
	r7 = h3d_impl_MemoryManager_cleanTextures(r0,r3);
	if( r7 ) goto label$88467e8_15_22;
	r9 = (String)s$Maximum_texture_memory_reached;
	r8 = haxe_Exception_thrown(((vdynamic*)r9));
	hl_throw((vdynamic*)r8);
	label$88467e8_15_22:
	h3d_impl_MemoryManager_allocTexture(r0,r1);
	return;
	label$88467e8_15_24:
	r11 = r0->textures;
	if( r11 == NULL ) hl_null_access();
	r10 = hl_types_ArrayObj_push(r11,((vdynamic*)r1));
	r12 = r0->texMemory;
	r10 = r1->width;
	r13 = r1->height;
	r10 = r10 * r13;
	r13 = h3d_impl_MemoryManager_bpp(r0,r1);
	r10 = r10 * r13;
	r14 = (double)r10;
	r12 = r12 + r14;
	r0->texMemory = r12;
	return;
}

void h3d_impl_MemoryManager_allocDepth(h3d__impl__MemoryManager r0,h3d__mat__DepthBuffer r1) {
	String r9;
	bool *r3;
	hl__types__ArrayObj r11;
	vvirtual *r5;
	bool r2, r7;
	double r12, r14;
	vdynamic *r8;
	h3d__impl__Driver r6;
	int r10, r13;
	r2 = false;
	r3 = &r2;
	r2 = h3d_impl_MemoryManager_cleanTextures(r0,r3);
	if( r1 == NULL ) hl_null_access();
	r6 = r0->driver;
	if( r6 == NULL ) hl_null_access();
	r5 = ((vvirtual* (*)(h3d__impl__Driver,h3d__mat__DepthBuffer))r6->$type->vobj_proto[17])(r6,r1);
	r1->b = r5;
	r5 = r1->b;
	if( r5 ) goto label$88467e8_16_24;
	r6 = r0->driver;
	if( r6 == NULL ) hl_null_access();
	r7 = ((bool (*)(h3d__impl__Driver))r6->$type->vobj_proto[3])(r6);
	if( !r7 ) goto label$88467e8_16_15;
	return;
	label$88467e8_16_15:
	r7 = true;
	r3 = &r7;
	r7 = h3d_impl_MemoryManager_cleanTextures(r0,r3);
	if( r7 ) goto label$88467e8_16_22;
	r9 = (String)s$Maximum_texture_memory_reached;
	r8 = haxe_Exception_thrown(((vdynamic*)r9));
	hl_throw((vdynamic*)r8);
	label$88467e8_16_22:
	h3d_impl_MemoryManager_allocDepth(r0,r1);
	return;
	label$88467e8_16_24:
	r11 = r0->depths;
	if( r11 == NULL ) hl_null_access();
	r10 = hl_types_ArrayObj_push(r11,((vdynamic*)r1));
	r12 = r0->texMemory;
	r10 = r1->width;
	r13 = r1->height;
	r10 = r10 * r13;
	r13 = 4;
	r10 = r10 * r13;
	r14 = (double)r10;
	r12 = r12 + r14;
	r0->texMemory = r12;
	return;
}

void h3d_impl_MemoryManager_deleteDepth(h3d__impl__MemoryManager r0,h3d__mat__DepthBuffer r1) {
	hl__types__ArrayObj r4;
	bool r3;
	double r6, r9;
	h3d__impl__Driver r5;
	int r7, r8;
	r4 = r0->depths;
	if( r4 == NULL ) hl_null_access();
	r3 = hl_types_ArrayObj_remove(r4,((vdynamic*)r1));
	if( r3 ) goto label$88467e8_17_5;
	return;
	label$88467e8_17_5:
	r5 = r0->driver;
	if( r5 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,h3d__mat__DepthBuffer))r5->$type->vobj_proto[18])(r5,r1);
	r6 = r0->texMemory;
	if( r1 == NULL ) hl_null_access();
	r7 = r1->width;
	r8 = r1->height;
	r7 = r7 * r8;
	r8 = 4;
	r7 = r7 * r8;
	r9 = (double)r7;
	r6 = r6 - r9;
	r0->texMemory = r6;
	return;
}

void h3d_impl_MemoryManager_onContextLost(h3d__impl__MemoryManager r0) {
	h3d_impl_MemoryManager_dispose(r0);
	h3d_impl_MemoryManager_initIndexes(r0);
	return;
}

void h3d_impl_MemoryManager_dispose(h3d__impl__MemoryManager r0) {
	h3d__mat__DepthBuffer r9;
	hl__types__ArrayObj r4;
	hl_type *r13;
	double r14;
	vdynamic *r7;
	h3d__impl__ManagedBuffer r10, r11, r12;
	varray *r8;
	h3d__mat__Texture r6;
	int r3, r5;
	h3d__Indexes r2;
	r2 = r0->triIndexes;
	if( !r2 ) goto label$88467e8_19_5;
	r2 = r0->triIndexes;
	if( r2 == NULL ) hl_null_access();
	h3d_Indexes_dispose(r2);
	label$88467e8_19_5:
	r2 = r0->quadIndexes;
	if( !r2 ) goto label$88467e8_19_10;
	r2 = r0->quadIndexes;
	if( r2 == NULL ) hl_null_access();
	h3d_Indexes_dispose(r2);
	label$88467e8_19_10:
	r2 = NULL;
	r0->triIndexes = r2;
	r2 = NULL;
	r0->quadIndexes = r2;
	r3 = 0;
	r4 = r0->textures;
	if( r4 == NULL ) hl_null_access();
	r4 = hl_types_ArrayObj_copy(r4);
	label$88467e8_19_18:
	if( r4 == NULL ) hl_null_access();
	r5 = r4->length;
	if( r3 >= r5 ) goto label$88467e8_19_33;
	r5 = r4->length;
	if( ((unsigned)r3) < ((unsigned)r5) ) goto label$88467e8_19_26;
	r6 = NULL;
	goto label$88467e8_19_29;
	label$88467e8_19_26:
	r8 = r4->array;
	r7 = ((vdynamic**)(r8 + 1))[r3];
	r6 = (h3d__mat__Texture)r7;
	label$88467e8_19_29:
	++r3;
	if( r6 == NULL ) hl_null_access();
	h3d_mat_Texture_dispose(r6);
	goto label$88467e8_19_18;
	label$88467e8_19_33:
	r3 = 0;
	r4 = r0->depths;
	if( r4 == NULL ) hl_null_access();
	r4 = hl_types_ArrayObj_copy(r4);
	label$88467e8_19_37:
	if( r4 == NULL ) hl_null_access();
	r5 = r4->length;
	if( r3 >= r5 ) goto label$88467e8_19_52;
	r5 = r4->length;
	if( ((unsigned)r3) < ((unsigned)r5) ) goto label$88467e8_19_45;
	r9 = NULL;
	goto label$88467e8_19_48;
	label$88467e8_19_45:
	r8 = r4->array;
	r7 = ((vdynamic**)(r8 + 1))[r3];
	r9 = (h3d__mat__DepthBuffer)r7;
	label$88467e8_19_48:
	++r3;
	if( r9 == NULL ) hl_null_access();
	h3d_mat_DepthBuffer_dispose(r9);
	goto label$88467e8_19_37;
	label$88467e8_19_52:
	r3 = 0;
	r4 = r0->buffers;
	if( r4 == NULL ) hl_null_access();
	r4 = hl_types_ArrayObj_copy(r4);
	label$88467e8_19_56:
	if( r4 == NULL ) hl_null_access();
	r5 = r4->length;
	if( r3 >= r5 ) goto label$88467e8_19_77;
	r5 = r4->length;
	if( ((unsigned)r3) < ((unsigned)r5) ) goto label$88467e8_19_64;
	r10 = NULL;
	goto label$88467e8_19_67;
	label$88467e8_19_64:
	r8 = r4->array;
	r7 = ((vdynamic**)(r8 + 1))[r3];
	r10 = (h3d__impl__ManagedBuffer)r7;
	label$88467e8_19_67:
	++r3;
	r11 = r10;
	label$88467e8_19_69:
	if( !r11 ) goto label$88467e8_19_76;
	if( r11 == NULL ) hl_null_access();
	h3d_impl_ManagedBuffer_dispose(r11);
	r12 = r11->next;
	r11 = r12;
	goto label$88467e8_19_69;
	label$88467e8_19_76:
	goto label$88467e8_19_56;
	label$88467e8_19_77:
	r3 = 0;
	r4 = r0->indexes;
	if( r4 == NULL ) hl_null_access();
	r4 = hl_types_ArrayObj_copy(r4);
	label$88467e8_19_81:
	if( r4 == NULL ) hl_null_access();
	r5 = r4->length;
	if( r3 >= r5 ) goto label$88467e8_19_96;
	r5 = r4->length;
	if( ((unsigned)r3) < ((unsigned)r5) ) goto label$88467e8_19_89;
	r2 = NULL;
	goto label$88467e8_19_92;
	label$88467e8_19_89:
	r8 = r4->array;
	r7 = ((vdynamic**)(r8 + 1))[r3];
	r2 = (h3d__Indexes)r7;
	label$88467e8_19_92:
	++r3;
	if( r2 == NULL ) hl_null_access();
	h3d_Indexes_dispose(r2);
	goto label$88467e8_19_81;
	label$88467e8_19_96:
	r13 = &t$h3d_impl_ManagedBuffer;
	r3 = 0;
	r8 = hl_alloc_array(r13,r3);
	r4 = hl_types_ArrayObj_alloc(r8);
	r0->buffers = r4;
	r13 = &t$h3d_Indexes;
	r3 = 0;
	r8 = hl_alloc_array(r13,r3);
	r4 = hl_types_ArrayObj_alloc(r8);
	r0->indexes = r4;
	r13 = &t$h3d_mat_Texture;
	r3 = 0;
	r8 = hl_alloc_array(r13,r3);
	r4 = hl_types_ArrayObj_alloc(r8);
	r0->textures = r4;
	r3 = 0;
	r0->bufferCount = r3;
	r14 = 0.;
	r0->usedMemory = r14;
	r14 = 0.;
	r0->texMemory = r14;
	return;
}

int h3d_impl_MemoryManager_freeMemorySize(h3d__impl__MemoryManager r0) {
	hl__types__ArrayObj r3;
	h3d__impl___ManagedBuffer__FreeCell r11, r12;
	vdynamic *r7;
	varray *r8;
	h3d__impl__ManagedBuffer r6, r9, r10;
	int r1, r2, r4, r5, r13;
	r1 = 0;
	r2 = 0;
	r3 = r0->buffers;
	label$88467e8_20_3:
	if( r3 == NULL ) hl_null_access();
	r5 = r3->length;
	if( r2 >= r5 ) goto label$88467e8_20_39;
	r5 = r3->length;
	if( ((unsigned)r2) < ((unsigned)r5) ) goto label$88467e8_20_11;
	r6 = NULL;
	goto label$88467e8_20_14;
	label$88467e8_20_11:
	r8 = r3->array;
	r7 = ((vdynamic**)(r8 + 1))[r2];
	r6 = (h3d__impl__ManagedBuffer)r7;
	label$88467e8_20_14:
	++r2;
	r9 = r6;
	label$88467e8_20_16:
	if( !r9 ) goto label$88467e8_20_38;
	if( r9 == NULL ) hl_null_access();
	r11 = r9->freeList;
	label$88467e8_20_20:
	if( !r11 ) goto label$88467e8_20_34;
	if( r11 == NULL ) hl_null_access();
	r5 = r11->count;
	if( r9 == NULL ) hl_null_access();
	r13 = r9->stride;
	r5 = r5 * r13;
	r13 = 4;
	r5 = r5 * r13;
	r4 = r1 + r5;
	r1 = r4;
	r12 = r11->next;
	r11 = r12;
	goto label$88467e8_20_20;
	label$88467e8_20_34:
	if( r9 == NULL ) hl_null_access();
	r10 = r9->next;
	r9 = r10;
	goto label$88467e8_20_16;
	label$88467e8_20_38:
	goto label$88467e8_20_3;
	label$88467e8_20_39:
	return r1;
}

void h3d_impl_MemoryManager_new(h3d__impl__MemoryManager r0,h3d__impl__Driver r1) {
	double r4;
	vclosure *r2;
	int r3;
	r2 = r0->garbage;
	if( r2 ) goto label$88467e8_21_4;
	r2 = hl_alloc_closure_ptr(&t$fun_4bffad7,h3d_impl_MemoryManager_garbage,r0);
	r0->garbage = r2;
	label$88467e8_21_4:
	r3 = 0;
	r0->bufferCount = r3;
	r4 = 0.;
	r0->texMemory = r4;
	r4 = 0.;
	r0->usedMemory = r4;
	r0->driver = r1;
	return;
}

