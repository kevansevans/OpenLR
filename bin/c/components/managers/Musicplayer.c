// Generated by HLC 4.1.5 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <components/managers/Musicplayer.h>
extern hl_type t$hxd_res_Sound;
#include <hxd/fs/FileEntry.h>
void hxd_res_Sound_new(hxd__res__Sound,hxd__fs__FileEntry);
#include <components/stage/LRConsole.h>
#include <_std/Main.h>
#include <haxe/io/Bytes.h>
extern String s$;
String String___add__(String,String);
bool sys_FileSystem_exists(String);
extern $Main g$_Main;
extern String s$_is_not_present_;
extern hl_type t$_i32;
#include <h2d/Console.h>
void h2d_Console_log(h2d__Console,String,vdynamic*);
haxe__io__Bytes hxd_File_getBytes(String);
extern hl_type t$hxd_fs_BytesFileEntry;
void hxd_fs_BytesFileEntry_new(hxd__fs__BytesFileEntry,String,haxe__io__Bytes);
extern hl_type t$ctx_69acb46;
extern hl_type t$fun_13e5d39;
void hxd_fs_BytesFileEntry_load(hxd__fs__BytesFileEntry,vclosure*);
extern String s$Audio_has_ended_;
#include <components/managers/Simulation.h>
#include <hxd/snd/ChannelGroup.h>
#include <hxd/snd/SoundGroup.h>
#include <hxd/snd/Effect.h>
extern hl_type t$fun_7b48b4f;
hxd__snd__Channel hxd_res_Sound_play(hxd__res__Sound,vdynamic*,vdynamic*,hxd__snd__ChannelGroup,hxd__snd__SoundGroup);
#include <hxd/snd/ChannelBase.h>
double hxd_snd_ChannelBase_set_volume(hxd__snd__ChannelBase,double);
hxd__snd__Effect hxd_snd_ChannelBase_addEffect(hxd__snd__ChannelBase,hxd__snd__Effect);
double hxd_snd_Channel_set_position(hxd__snd__Channel,double);
void hxd_snd_Channel_stop(hxd__snd__Channel);
extern hl_type t$hxd_snd_effect_Pitch;
void hxd_snd_effect_Pitch_new(hxd__snd__effect__Pitch,double*);

void components_managers_Musicplayer_loadAudio__$1(venum* r0) {
	components__managers__Musicplayer r1;
	hxd__fs__BytesFileEntry r3;
	hxd__res__Sound r2;
	r1 = ((Enumt$ctx_69acb46*)r0)->p1;
	if( r1 == NULL ) hl_null_access();
	r2 = (hxd__res__Sound)hl_alloc_obj(&t$hxd_res_Sound);
	r3 = ((Enumt$ctx_69acb46*)r0)->p0;
	hxd_res_Sound_new(r2,((hxd__fs__FileEntry)r3));
	r1->sound = r2;
	return;
}

void components_managers_Musicplayer_loadAudio(components__managers__Musicplayer r0,String r1) {
	String r4, r5;
	venum *r13;
	haxe__io__Bytes r10;
	bool r3;
	hxd__fs__BytesFileEntry r11;
	$Main r7;
	vclosure *r12;
	vdynamic *r9;
	int r8;
	components__stage__LRConsole r6;
	r4 = (String)s$;
	r4 = String___add__(r4,r1);
	r3 = sys_FileSystem_exists(r4);
	if( r3 ) goto label$22fe1bd_2_15;
	r7 = ($Main)g$_Main;
	r6 = r7->console;
	if( r6 == NULL ) hl_null_access();
	r4 = (String)s$;
	r4 = String___add__(r4,r1);
	r5 = (String)s$_is_not_present_;
	r4 = String___add__(r4,r5);
	r8 = 16711680;
	r9 = hl_alloc_dynamic(&t$_i32);
	r9->v.i = r8;
	h2d_Console_log(((h2d__Console)r6),r4,r9);
	return;
	label$22fe1bd_2_15:
	r4 = (String)s$;
	r4 = String___add__(r4,r1);
	r10 = hxd_File_getBytes(r4);
	r11 = (hxd__fs__BytesFileEntry)hl_alloc_obj(&t$hxd_fs_BytesFileEntry);
	r4 = (String)s$;
	r4 = String___add__(r4,r1);
	hxd_fs_BytesFileEntry_new(r11,r4,r10);
	r13 = hl_alloc_enum(&t$ctx_69acb46,0);
	((Enumt$ctx_69acb46*)r13)->p0 = (hxd__fs__BytesFileEntry)r11;
	((Enumt$ctx_69acb46*)r13)->p1 = (components__managers__Musicplayer)r0;
	r12 = hl_alloc_closure_ptr(&t$fun_13e5d39,components_managers_Musicplayer_loadAudio__$1,r13);
	hxd_fs_BytesFileEntry_load(r11,r12);
	r7 = ($Main)g$_Main;
	r7->songName = r1;
	return;
}

void components_managers_Musicplayer_loadAudioAsBytes__$1(venum* r0) {
	components__managers__Musicplayer r1;
	hxd__fs__BytesFileEntry r3;
	hxd__res__Sound r2;
	r1 = ((Enumt$ctx_69acb46*)r0)->p1;
	if( r1 == NULL ) hl_null_access();
	r2 = (hxd__res__Sound)hl_alloc_obj(&t$hxd_res_Sound);
	r3 = ((Enumt$ctx_69acb46*)r0)->p0;
	hxd_res_Sound_new(r2,((hxd__fs__FileEntry)r3));
	r1->sound = r2;
	return;
}

void components_managers_Musicplayer_loadAudioAsBytes(components__managers__Musicplayer r0,haxe__io__Bytes r1,String r2) {
	String r5;
	venum *r7;
	hxd__fs__BytesFileEntry r4;
	$Main r8;
	vclosure *r6;
	r4 = (hxd__fs__BytesFileEntry)hl_alloc_obj(&t$hxd_fs_BytesFileEntry);
	r5 = (String)s$;
	hxd_fs_BytesFileEntry_new(r4,r5,r1);
	r7 = hl_alloc_enum(&t$ctx_69acb46,0);
	((Enumt$ctx_69acb46*)r7)->p0 = (hxd__fs__BytesFileEntry)r4;
	((Enumt$ctx_69acb46*)r7)->p1 = (components__managers__Musicplayer)r0;
	r6 = hl_alloc_closure_ptr(&t$fun_13e5d39,components_managers_Musicplayer_loadAudioAsBytes__$1,r7);
	hxd_fs_BytesFileEntry_load(r4,r6);
	r8 = ($Main)g$_Main;
	r8->songName = r2;
	return;
}

void components_managers_Musicplayer_playMusic__$1() {
	String r3;
	$Main r2;
	vdynamic *r4;
	components__stage__LRConsole r1;
	r2 = ($Main)g$_Main;
	r1 = r2->console;
	if( r1 == NULL ) hl_null_access();
	r3 = (String)s$Audio_has_ended_;
	r4 = NULL;
	h2d_Console_log(((h2d__Console)r1),r3,r4);
	return;
}

void components_managers_Musicplayer_playMusic(components__managers__Musicplayer r0,int r1) {
	hxd__snd__effect__Pitch r14;
	bool r4;
	hxd__snd__Effect r13;
	hxd__res__Sound r3;
	$Main r6;
	hxd__snd__Channel r7;
	vclosure *r16;
	double r12, r15;
	hxd__snd__SoundGroup r11;
	components__managers__Simulation r5;
	vdynamic *r8, *r9;
	hxd__snd__ChannelGroup r10;
	static vclosure cl$0 = { &t$fun_7b48b4f, components_managers_Musicplayer_playMusic__$1, 0 };
	r3 = r0->sound;
	if( r3 ) goto label$22fe1bd_6_3;
	return;
	label$22fe1bd_6_3:
	r6 = ($Main)g$_Main;
	r5 = r6->simulation;
	if( r5 == NULL ) hl_null_access();
	r4 = r5->playing;
	if( r4 ) goto label$22fe1bd_6_9;
	return;
	label$22fe1bd_6_9:
	r3 = r0->sound;
	if( r3 == NULL ) hl_null_access();
	r8 = NULL;
	r9 = NULL;
	r10 = NULL;
	r11 = NULL;
	r7 = hxd_res_Sound_play(r3,r8,r9,r10,r11);
	r0->mixer = r7;
	r7 = r0->mixer;
	if( r7 == NULL ) hl_null_access();
	r12 = 0.25;
	r12 = hxd_snd_ChannelBase_set_volume(((hxd__snd__ChannelBase)r7),r12);
	r7 = r0->mixer;
	if( r7 == NULL ) hl_null_access();
	r14 = r0->speedfilter;
	r13 = hxd_snd_ChannelBase_addEffect(((hxd__snd__ChannelBase)r7),((hxd__snd__Effect)r14));
	r14 = (hxd__snd__effect__Pitch)r13;
	r7 = r0->mixer;
	if( r7 == NULL ) hl_null_access();
	r12 = (double)r1;
	r15 = 40.;
	r12 = r12 / r15;
	r15 = r0->offset;
	r12 = r12 + r15;
	r12 = hxd_snd_Channel_set_position(r7,r12);
	r7 = r0->mixer;
	if( r7 == NULL ) hl_null_access();
	r16 = &cl$0;
	r7->onEnd = r16;
	r4 = true;
	r0->playing = r4;
	return;
}

void components_managers_Musicplayer_stopMusic(components__managers__Musicplayer r0) {
	bool r3;
	hxd__res__Sound r2;
	hxd__snd__Channel r4;
	r2 = r0->sound;
	if( r2 ) goto label$22fe1bd_7_3;
	return;
	label$22fe1bd_7_3:
	r3 = r0->playing;
	if( !r3 ) goto label$22fe1bd_7_8;
	r4 = r0->mixer;
	if( r4 == NULL ) hl_null_access();
	hxd_snd_Channel_stop(r4);
	label$22fe1bd_7_8:
	r3 = false;
	r0->playing = r3;
	return;
}

void components_managers_Musicplayer_new(components__managers__Musicplayer r0) {
	hxd__snd__effect__Pitch r3;
	bool r1;
	double r2;
	double *r4;
	r1 = false;
	r0->playing = r1;
	r2 = 0.;
	r0->offset = r2;
	r3 = (hxd__snd__effect__Pitch)hl_alloc_obj(&t$hxd_snd_effect_Pitch);
	r4 = NULL;
	hxd_snd_effect_Pitch_new(r3,r4);
	r0->speedfilter = r3;
	return;
}

