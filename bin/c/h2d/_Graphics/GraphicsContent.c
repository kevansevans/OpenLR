// Generated by HLC 4.1.5 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <h2d/_Graphics/GraphicsContent.h>
void h3d_prim_Primitive_new(h3d__prim__Primitive);
extern hl_type t$vrt_3d3439a;
#include <hl/natives.h>
hl__types__ArrayObj hl_types_ArrayObj_alloc(varray*);
extern hl_type t$hl_types_ArrayBytes_hl_F32;
extern hl_type t$hl_types_ArrayBytes_hl_UI16;
extern hl_type t$h3d_Buffer;
extern hl_type t$h3d_Indexes;
int hl_types_ArrayObj_push(hl__types__ArrayObj,vdynamic*);
void hl_types_ArrayBytes_hl_F32_new(hl__types__ArrayBytes_hl_F32);
void hl_types_ArrayBytes_hl_F32___expand(hl__types__ArrayBytes_hl_F32,int);
void hl_types_ArrayBytes_hl_UI16_new(hl__types__ArrayBytes_hl_UI16);
void hl_types_ArrayBytes_hl_UI16___expand(hl__types__ArrayBytes_hl_UI16,int);
void h3d_prim_Primitive_dispose(h3d__prim__Primitive);
#include <h3d/Engine.h>
#include <hxd/impl/Allocator.h>
hxd__impl__Allocator hxd_impl_Allocator_get(void);
h3d__Buffer hxd_impl_Allocator_ofFloats(hxd__impl__Allocator,hl__types__ArrayBytes_hl_F32,int,int);
h3d__Indexes hxd_impl_Allocator_ofIndexes(hxd__impl__Allocator,hl__types__ArrayBytes_hl_UI16,int*);
bool h3d_Buffer_isDisposed(h3d__Buffer);
bool h3d_Indexes_isDisposed(h3d__Indexes);
void h2d__Graphics_GraphicsContent_flush(h2d___Graphics__GraphicsContent);
void h3d_Engine_renderIndexed(h3d__Engine,h3d__Buffer,h3d__Indexes,int*,int*);
void h3d_prim_Primitive_render(h3d__prim__Primitive,h3d__Engine);
extern h3d__$Engine g$_h3d_Engine;
void hxd_impl_Allocator_disposeBuffer(hxd__impl__Allocator,h3d__Buffer);
void hxd_impl_Allocator_disposeIndexBuffer(hxd__impl__Allocator,h3d__Indexes);

void h2d__Graphics_GraphicsContent_new(h2d___Graphics__GraphicsContent r0) {
	hl__types__ArrayObj r2;
	hl_type *r4;
	int r5;
	varray *r3;
	h3d_prim_Primitive_new(((h3d__prim__Primitive)r0));
	r4 = &t$vrt_3d3439a;
	r5 = 0;
	r3 = hl_alloc_array(r4,r5);
	r2 = hl_types_ArrayObj_alloc(r3);
	r0->buffers = r2;
	return;
}

bool h2d__Graphics_GraphicsContent_next(h2d___Graphics__GraphicsContent r0) {
	vvirtual *r8;
	hl__types__ArrayObj r7;
	bool r6;
	hl__types__ArrayBytes_hl_F32 r2;
	hl__types__ArrayBytes_hl_UI16 r9;
	unsigned short r17;
	float r14;
	double r13;
	h3d__Buffer r10;
	vbyte *r15;
	h3d__Indexes r11;
	int r1, r3, r5, r12, r16, r18;
	r2 = r0->tmp;
	if( r2 == NULL ) hl_null_access();
	r1 = r2->length;
	r3 = 3;
	r1 = r1 >> r3;
	r5 = 32768;
	if( r1 >= r5 ) goto label$dc6e5fb_2_9;
	r6 = false;
	return r6;
	label$dc6e5fb_2_9:
	r7 = r0->buffers;
	if( r7 == NULL ) hl_null_access();
	r8 = hl_alloc_virtual(&t$vrt_3d3439a);
	r2 = r0->tmp;
	if( hl_vfields(r8)[0] ) *(hl__types__ArrayBytes_hl_F32*)(hl_vfields(r8)[0]) = (hl__types__ArrayBytes_hl_F32)r2; else hl_dyn_setp(r8->value,4899635/*buf*/,&t$hl_types_ArrayBytes_hl_F32,r2);
	r9 = r0->index;
	if( hl_vfields(r8)[2] ) *(hl__types__ArrayBytes_hl_UI16*)(hl_vfields(r8)[2]) = (hl__types__ArrayBytes_hl_UI16)r9; else hl_dyn_setp(r8->value,5243965/*idx*/,&t$hl_types_ArrayBytes_hl_UI16,r9);
	r10 = NULL;
	if( hl_vfields(r8)[3] ) *(h3d__Buffer*)(hl_vfields(r8)[3]) = (h3d__Buffer)r10; else hl_dyn_setp(r8->value,239726983/*vbuf*/,&t$h3d_Buffer,r10);
	r11 = NULL;
	if( hl_vfields(r8)[1] ) *(h3d__Indexes*)(hl_vfields(r8)[1]) = (h3d__Indexes)r11; else hl_dyn_setp(r8->value,95562612/*ibuf*/,&t$h3d_Indexes,r11);
	r3 = hl_types_ArrayObj_push(r7,((vdynamic*)r8));
	r3 = 0;
	r2 = (hl__types__ArrayBytes_hl_F32)hl_alloc_obj(&t$hl_types_ArrayBytes_hl_F32);
	hl_types_ArrayBytes_hl_F32_new(r2);
	r12 = 0;
	if( r12 >= r3 ) goto label$dc6e5fb_2_39;
	r12 = r2->length;
	if( r12 >= r3 ) goto label$dc6e5fb_2_39;
	r12 = 1;
	r5 = r3 - r12;
	r13 = 0.;
	r14 = (float)r13;
	r12 = r2->length;
	if( ((unsigned)r5) < ((unsigned)r12) ) goto label$dc6e5fb_2_35;
	hl_types_ArrayBytes_hl_F32___expand(r2,r5);
	label$dc6e5fb_2_35:
	r15 = r2->bytes;
	r12 = 2;
	r12 = r5 << r12;
	*(float*)(r15 + r12) = r14;
	label$dc6e5fb_2_39:
	r0->tmp = r2;
	r5 = 0;
	r9 = (hl__types__ArrayBytes_hl_UI16)hl_alloc_obj(&t$hl_types_ArrayBytes_hl_UI16);
	hl_types_ArrayBytes_hl_UI16_new(r9);
	r16 = 0;
	if( r16 >= r5 ) goto label$dc6e5fb_2_59;
	r16 = r9->length;
	if( r16 >= r5 ) goto label$dc6e5fb_2_59;
	r16 = 1;
	r12 = r5 - r16;
	r16 = 0;
	r17 = (int)r16;
	r16 = (int)r17;
	r18 = r9->length;
	if( ((unsigned)r12) < ((unsigned)r18) ) goto label$dc6e5fb_2_55;
	hl_types_ArrayBytes_hl_UI16___expand(r9,r12);
	label$dc6e5fb_2_55:
	r15 = r9->bytes;
	r18 = 1;
	r18 = r12 << r18;
	*(unsigned short*)(r15 + r18) = (unsigned short)r16;
	label$dc6e5fb_2_59:
	r0->index = r9;
	h3d_prim_Primitive_dispose(((h3d__prim__Primitive)r0));
	r6 = true;
	return r6;
}

void h2d__Graphics_GraphicsContent_alloc(h2d___Graphics__GraphicsContent r0,h3d__Engine r1) {
	vvirtual *r14;
	hl__types__ArrayObj r12;
	bool r16;
	hl__types__ArrayBytes_hl_F32 r9;
	hl__types__ArrayBytes_hl_UI16 r4;
	hxd__impl__Allocator r7;
	h3d__Buffer r8;
	int *r11;
	vdynamic *r6;
	varray *r15;
	h3d__Indexes r10;
	int r3, r5, r13;
	r4 = r0->index;
	if( r4 == NULL ) hl_null_access();
	r3 = r4->length;
	r5 = 0;
	if( r5 < r3 ) goto label$dc6e5fb_3_6;
	return;
	label$dc6e5fb_3_6:
	r7 = hxd_impl_Allocator_get();
	if( r7 == NULL ) hl_null_access();
	r9 = r0->tmp;
	r3 = 8;
	r5 = 2;
	r8 = hxd_impl_Allocator_ofFloats(r7,r9,r3,r5);
	r0->buffer = r8;
	r4 = r0->index;
	r11 = NULL;
	r10 = hxd_impl_Allocator_ofIndexes(r7,r4,r11);
	r0->indexes = r10;
	r3 = 0;
	r12 = r0->buffers;
	label$dc6e5fb_3_19:
	if( r12 == NULL ) hl_null_access();
	r13 = r12->length;
	if( r3 >= r13 ) goto label$dc6e5fb_3_56;
	r13 = r12->length;
	if( ((unsigned)r3) < ((unsigned)r13) ) goto label$dc6e5fb_3_27;
	r14 = NULL;
	goto label$dc6e5fb_3_30;
	label$dc6e5fb_3_27:
	r15 = r12->array;
	r6 = ((vdynamic**)(r15 + 1))[r3];
	r14 = hl_to_virtual(&t$vrt_3d3439a,(vdynamic*)r6);
	label$dc6e5fb_3_30:
	++r3;
	if( r14 == NULL ) hl_null_access();
	r8 = hl_vfields(r14)[3] ? (*(h3d__Buffer*)(hl_vfields(r14)[3])) : (h3d__Buffer)hl_dyn_getp(r14->value,239726983/*vbuf*/,&t$h3d_Buffer);
	if( !r8 ) goto label$dc6e5fb_3_38;
	r8 = hl_vfields(r14)[3] ? (*(h3d__Buffer*)(hl_vfields(r14)[3])) : (h3d__Buffer)hl_dyn_getp(r14->value,239726983/*vbuf*/,&t$h3d_Buffer);
	if( r8 == NULL ) hl_null_access();
	r16 = h3d_Buffer_isDisposed(r8);
	if( !r16 ) goto label$dc6e5fb_3_44;
	label$dc6e5fb_3_38:
	if( r7 == NULL ) hl_null_access();
	r9 = hl_vfields(r14)[0] ? (*(hl__types__ArrayBytes_hl_F32*)(hl_vfields(r14)[0])) : (hl__types__ArrayBytes_hl_F32)hl_dyn_getp(r14->value,4899635/*buf*/,&t$hl_types_ArrayBytes_hl_F32);
	r5 = 8;
	r13 = 2;
	r8 = hxd_impl_Allocator_ofFloats(r7,r9,r5,r13);
	if( hl_vfields(r14)[3] ) *(h3d__Buffer*)(hl_vfields(r14)[3]) = (h3d__Buffer)r8; else hl_dyn_setp(r14->value,239726983/*vbuf*/,&t$h3d_Buffer,r8);
	label$dc6e5fb_3_44:
	r10 = hl_vfields(r14)[1] ? (*(h3d__Indexes*)(hl_vfields(r14)[1])) : (h3d__Indexes)hl_dyn_getp(r14->value,95562612/*ibuf*/,&t$h3d_Indexes);
	if( !r10 ) goto label$dc6e5fb_3_50;
	r10 = hl_vfields(r14)[1] ? (*(h3d__Indexes*)(hl_vfields(r14)[1])) : (h3d__Indexes)hl_dyn_getp(r14->value,95562612/*ibuf*/,&t$h3d_Indexes);
	if( r10 == NULL ) hl_null_access();
	r16 = h3d_Indexes_isDisposed(r10);
	if( !r16 ) goto label$dc6e5fb_3_55;
	label$dc6e5fb_3_50:
	if( r7 == NULL ) hl_null_access();
	r4 = hl_vfields(r14)[2] ? (*(hl__types__ArrayBytes_hl_UI16*)(hl_vfields(r14)[2])) : (hl__types__ArrayBytes_hl_UI16)hl_dyn_getp(r14->value,5243965/*idx*/,&t$hl_types_ArrayBytes_hl_UI16);
	r11 = NULL;
	r10 = hxd_impl_Allocator_ofIndexes(r7,r4,r11);
	if( hl_vfields(r14)[1] ) *(h3d__Indexes*)(hl_vfields(r14)[1]) = (h3d__Indexes)r10; else hl_dyn_setp(r14->value,95562612/*ibuf*/,&t$h3d_Indexes,r10);
	label$dc6e5fb_3_55:
	goto label$dc6e5fb_3_19;
	label$dc6e5fb_3_56:
	r16 = false;
	r0->bufferDirty = r16;
	r16 = false;
	r0->indexDirty = r16;
	return;
}

void h2d__Graphics_GraphicsContent_render(h2d___Graphics__GraphicsContent r0,h3d__Engine r1) {
	vvirtual *r9;
	hl__types__ArrayObj r7;
	hl__types__ArrayBytes_hl_UI16 r4;
	h3d__Buffer r11;
	int *r13, *r14;
	vdynamic *r6;
	h3d__Indexes r12;
	varray *r10;
	int r3, r5, r8;
	r4 = r0->index;
	if( r4 == NULL ) hl_null_access();
	r3 = r4->length;
	r5 = 0;
	if( r5 < r3 ) goto label$dc6e5fb_4_6;
	return;
	label$dc6e5fb_4_6:
	h2d__Graphics_GraphicsContent_flush(r0);
	r3 = 0;
	r7 = r0->buffers;
	label$dc6e5fb_4_9:
	if( r7 == NULL ) hl_null_access();
	r8 = r7->length;
	if( r3 >= r8 ) goto label$dc6e5fb_4_29;
	r8 = r7->length;
	if( ((unsigned)r3) < ((unsigned)r8) ) goto label$dc6e5fb_4_17;
	r9 = NULL;
	goto label$dc6e5fb_4_20;
	label$dc6e5fb_4_17:
	r10 = r7->array;
	r6 = ((vdynamic**)(r10 + 1))[r3];
	r9 = hl_to_virtual(&t$vrt_3d3439a,(vdynamic*)r6);
	label$dc6e5fb_4_20:
	++r3;
	if( r1 == NULL ) hl_null_access();
	if( r9 == NULL ) hl_null_access();
	r11 = hl_vfields(r9)[3] ? (*(h3d__Buffer*)(hl_vfields(r9)[3])) : (h3d__Buffer)hl_dyn_getp(r9->value,239726983/*vbuf*/,&t$h3d_Buffer);
	r12 = hl_vfields(r9)[1] ? (*(h3d__Indexes*)(hl_vfields(r9)[1])) : (h3d__Indexes)hl_dyn_getp(r9->value,95562612/*ibuf*/,&t$h3d_Indexes);
	r13 = NULL;
	r14 = NULL;
	h3d_Engine_renderIndexed(r1,r11,r12,r13,r14);
	goto label$dc6e5fb_4_9;
	label$dc6e5fb_4_29:
	h3d_prim_Primitive_render(((h3d__prim__Primitive)r0),r1);
	return;
}

void h2d__Graphics_GraphicsContent_flush(h2d___Graphics__GraphicsContent r0) {
	hl__types__ArrayBytes_hl_F32 r7;
	bool r3;
	hl__types__ArrayBytes_hl_UI16 r11;
	hxd__impl__Allocator r6;
	h3d__Engine r4;
	h3d__$Engine r5;
	h3d__Buffer r2;
	int *r12;
	h3d__Indexes r10;
	int r8, r9;
	r2 = r0->buffer;
	if( !r2 ) goto label$dc6e5fb_5_6;
	r2 = r0->buffer;
	if( r2 == NULL ) hl_null_access();
	r3 = h3d_Buffer_isDisposed(r2);
	if( !r3 ) goto label$dc6e5fb_5_10;
	label$dc6e5fb_5_6:
	r5 = (h3d__$Engine)g$_h3d_Engine;
	r4 = r5->CURRENT;
	h2d__Graphics_GraphicsContent_alloc(r0,r4);
	goto label$dc6e5fb_5_34;
	label$dc6e5fb_5_10:
	r6 = hxd_impl_Allocator_get();
	r3 = r0->bufferDirty;
	if( !r3 ) goto label$dc6e5fb_5_23;
	if( r6 == NULL ) hl_null_access();
	r2 = r0->buffer;
	hxd_impl_Allocator_disposeBuffer(r6,r2);
	r7 = r0->tmp;
	r8 = 8;
	r9 = 2;
	r2 = hxd_impl_Allocator_ofFloats(r6,r7,r8,r9);
	r0->buffer = r2;
	r3 = false;
	r0->bufferDirty = r3;
	label$dc6e5fb_5_23:
	r3 = r0->indexDirty;
	if( !r3 ) goto label$dc6e5fb_5_34;
	if( r6 == NULL ) hl_null_access();
	r10 = r0->indexes;
	hxd_impl_Allocator_disposeIndexBuffer(r6,r10);
	r11 = r0->index;
	r12 = NULL;
	r10 = hxd_impl_Allocator_ofIndexes(r6,r11,r12);
	r0->indexes = r10;
	r3 = false;
	r0->indexDirty = r3;
	label$dc6e5fb_5_34:
	return;
}

void h2d__Graphics_GraphicsContent_dispose(h2d___Graphics__GraphicsContent r0) {
	vvirtual *r5;
	hl__types__ArrayObj r3;
	hxd__impl__Allocator r9;
	h3d__Buffer r8;
	vdynamic *r6;
	h3d__Indexes r10;
	varray *r7;
	int r1, r4;
	r1 = 0;
	r3 = r0->buffers;
	label$dc6e5fb_6_2:
	if( r3 == NULL ) hl_null_access();
	r4 = r3->length;
	if( r1 >= r4 ) goto label$dc6e5fb_6_32;
	r4 = r3->length;
	if( ((unsigned)r1) < ((unsigned)r4) ) goto label$dc6e5fb_6_10;
	r5 = NULL;
	goto label$dc6e5fb_6_13;
	label$dc6e5fb_6_10:
	r7 = r3->array;
	r6 = ((vdynamic**)(r7 + 1))[r1];
	r5 = hl_to_virtual(&t$vrt_3d3439a,(vdynamic*)r6);
	label$dc6e5fb_6_13:
	++r1;
	if( r5 == NULL ) hl_null_access();
	r8 = hl_vfields(r5)[3] ? (*(h3d__Buffer*)(hl_vfields(r5)[3])) : (h3d__Buffer)hl_dyn_getp(r5->value,239726983/*vbuf*/,&t$h3d_Buffer);
	if( !r8 ) goto label$dc6e5fb_6_21;
	r9 = hxd_impl_Allocator_get();
	if( r9 == NULL ) hl_null_access();
	r8 = hl_vfields(r5)[3] ? (*(h3d__Buffer*)(hl_vfields(r5)[3])) : (h3d__Buffer)hl_dyn_getp(r5->value,239726983/*vbuf*/,&t$h3d_Buffer);
	hxd_impl_Allocator_disposeBuffer(r9,r8);
	label$dc6e5fb_6_21:
	r10 = hl_vfields(r5)[1] ? (*(h3d__Indexes*)(hl_vfields(r5)[1])) : (h3d__Indexes)hl_dyn_getp(r5->value,95562612/*ibuf*/,&t$h3d_Indexes);
	if( !r10 ) goto label$dc6e5fb_6_27;
	r9 = hxd_impl_Allocator_get();
	if( r9 == NULL ) hl_null_access();
	r10 = hl_vfields(r5)[1] ? (*(h3d__Indexes*)(hl_vfields(r5)[1])) : (h3d__Indexes)hl_dyn_getp(r5->value,95562612/*ibuf*/,&t$h3d_Indexes);
	hxd_impl_Allocator_disposeIndexBuffer(r9,r10);
	label$dc6e5fb_6_27:
	r8 = NULL;
	if( hl_vfields(r5)[3] ) *(h3d__Buffer*)(hl_vfields(r5)[3]) = (h3d__Buffer)r8; else hl_dyn_setp(r5->value,239726983/*vbuf*/,&t$h3d_Buffer,r8);
	r10 = NULL;
	if( hl_vfields(r5)[1] ) *(h3d__Indexes*)(hl_vfields(r5)[1]) = (h3d__Indexes)r10; else hl_dyn_setp(r5->value,95562612/*ibuf*/,&t$h3d_Indexes,r10);
	goto label$dc6e5fb_6_2;
	label$dc6e5fb_6_32:
	r8 = r0->buffer;
	if( !r8 ) goto label$dc6e5fb_6_40;
	r9 = hxd_impl_Allocator_get();
	if( r9 == NULL ) hl_null_access();
	r8 = r0->buffer;
	hxd_impl_Allocator_disposeBuffer(r9,r8);
	r8 = NULL;
	r0->buffer = r8;
	label$dc6e5fb_6_40:
	r10 = r0->indexes;
	if( !r10 ) goto label$dc6e5fb_6_48;
	r9 = hxd_impl_Allocator_get();
	if( r9 == NULL ) hl_null_access();
	r10 = r0->indexes;
	hxd_impl_Allocator_disposeIndexBuffer(r9,r10);
	r10 = NULL;
	r0->indexes = r10;
	label$dc6e5fb_6_48:
	h3d_prim_Primitive_dispose(((h3d__prim__Primitive)r0));
	return;
}

void h2d__Graphics_GraphicsContent_clear(h2d___Graphics__GraphicsContent r0) {
	hl__types__ArrayObj r13;
	hl_type *r15;
	hl__types__ArrayBytes_hl_F32 r3;
	hl__types__ArrayBytes_hl_UI16 r9;
	unsigned short r11;
	float r7;
	double r6;
	varray *r14;
	vbyte *r8;
	int r2, r4, r5, r10, r12;
	h2d__Graphics_GraphicsContent_dispose(r0);
	r2 = 0;
	r3 = (hl__types__ArrayBytes_hl_F32)hl_alloc_obj(&t$hl_types_ArrayBytes_hl_F32);
	hl_types_ArrayBytes_hl_F32_new(r3);
	r5 = 0;
	if( r5 >= r2 ) goto label$dc6e5fb_7_19;
	r5 = r3->length;
	if( r5 >= r2 ) goto label$dc6e5fb_7_19;
	r5 = 1;
	r4 = r2 - r5;
	r6 = 0.;
	r7 = (float)r6;
	r5 = r3->length;
	if( ((unsigned)r4) < ((unsigned)r5) ) goto label$dc6e5fb_7_15;
	hl_types_ArrayBytes_hl_F32___expand(r3,r4);
	label$dc6e5fb_7_15:
	r8 = r3->bytes;
	r5 = 2;
	r5 = r4 << r5;
	*(float*)(r8 + r5) = r7;
	label$dc6e5fb_7_19:
	r0->tmp = r3;
	r4 = 0;
	r9 = (hl__types__ArrayBytes_hl_UI16)hl_alloc_obj(&t$hl_types_ArrayBytes_hl_UI16);
	hl_types_ArrayBytes_hl_UI16_new(r9);
	r10 = 0;
	if( r10 >= r4 ) goto label$dc6e5fb_7_39;
	r10 = r9->length;
	if( r10 >= r4 ) goto label$dc6e5fb_7_39;
	r10 = 1;
	r5 = r4 - r10;
	r10 = 0;
	r11 = (int)r10;
	r10 = (int)r11;
	r12 = r9->length;
	if( ((unsigned)r5) < ((unsigned)r12) ) goto label$dc6e5fb_7_35;
	hl_types_ArrayBytes_hl_UI16___expand(r9,r5);
	label$dc6e5fb_7_35:
	r8 = r9->bytes;
	r12 = 1;
	r12 = r5 << r12;
	*(unsigned short*)(r8 + r12) = (unsigned short)r10;
	label$dc6e5fb_7_39:
	r0->index = r9;
	r15 = &t$vrt_3d3439a;
	r5 = 0;
	r14 = hl_alloc_array(r15,r5);
	r13 = hl_types_ArrayObj_alloc(r14);
	r0->buffers = r13;
	return;
}

